const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/loader-DYaUNyr3.js","assets/index-Ds3x37R4.js","assets/index-Bq0sc0Rv.css","assets/resourceUtils-CGN3r06D.js"])))=>i.map(i=>d[i]);
import{pQ as ce,pR as me,pS as q,m5 as J,m6 as k,pT as de,pU as fe,_ as pe,pV as xe,ha as Te,h6 as he,aH as F,j8 as D,eX as ge,pW as W,e_ as be,ei as ye,pn as Re,mL as K,pX as ee,ee as $e,of as C,eg as H,n2 as te,pY as O,pZ as we,p_ as ve,p$ as Be,od as G,mo as Q,q0 as Me,b2 as I,n1 as Se,aM as M,aZ as S,mO as Ae,jJ as Oe,lH as X,lI as Z,mP as _e,q1 as Ee,q2 as Ie,q3 as z,q4 as Le,q5 as Pe,aX as qe,oP as Fe,q6 as Ce,q7 as je}from"./index-Ds3x37R4.js";import{a as Ve}from"./devEnvironmentUtils-BfO8ai13.js";import{o as Ue,d as Y}from"./vec4-CklyVFko.js";import{o as Ne,n as ke}from"./indexUtils-CVqty3hO.js";import{n as L}from"./resourceUtils-CGN3r06D.js";function A(t){if(t==null)return null;const r=t.offset!=null?t.offset:ce,o=t.rotation!=null?t.rotation:0,s=t.scale!=null?t.scale:me,c=q(1,0,0,0,1,0,r[0],r[1],1),d=q(Math.cos(o),-Math.sin(o),0,Math.sin(o),Math.cos(o),0,0,0,1),a=q(s[0],0,0,0,s[1],0,0,0,1),i=J();return k(i,d,a),k(i,c,i),i}class De{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class We{constructor(r,o,s){this.name=r,this.lodThreshold=o,this.pivotOffset=s,this.stageResources=new De,this.numberOfVertices=0}}async function He(t,r){var u;const o=re(Ve(t));if(o.fileType==="wosr"){const f=await(r.cache?r.cache.loadWOSR(o.url,r):de(o.url,r)),{engineResources:x,referenceBoundingBox:p}=fe(f,r);return{lods:x,referenceBoundingBox:p,isEsriSymbolResource:!1,isWosr:!0}}let s;if(r.cache)s=await r.cache.loadGLTF(o.url,r,!!r.usePBR);else{const{loadGLTF:f}=await pe(()=>import("./loader-DYaUNyr3.js"),__vite__mapDeps([0,1,2,3]));s=await f(new xe(r.streamDataRequester),o.url,r,r.usePBR)}const c=(u=s.model.meta)==null?void 0:u.ESRI_proxyEllipsoid,d=s.meta.isEsriSymbolResource&&c!=null&&s.meta.ESRI_webstyle==="EsriRealisticTreesStyle";d&&!s.customMeta.esriTreeRendering&&(s.customMeta.esriTreeRendering=!0,ze(s,c));const a=!!r.usePBR,i=s.meta.isEsriSymbolResource?{usePBR:a,isSchematic:!1,treeRendering:d,mrrFactors:Ce}:{usePBR:a,isSchematic:!1,treeRendering:!1,mrrFactors:je},l={...r.materialParameters,treeRendering:d},{engineResources:e,referenceBoundingBox:n}=Ge(s,i,l,r,o.specifiedLodIndex,d);return{lods:e,referenceBoundingBox:n,isEsriSymbolResource:s.meta.isEsriSymbolResource,isWosr:!1}}function re(t){const r=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return r?{fileType:"gltf",url:r[1],specifiedLodIndex:r[4]!=null?Number(r[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function Ge(t,r,o,s,c,d){const a=t.model,i=new Array,l=new Map,e=new Map,n=a.lods.length,u=$e();return a.lods.forEach(((f,x)=>{const p=s.skipHighLods===!0&&(n>1&&x===0||n>3&&x===1)||s.skipHighLods===!1&&c!=null&&x!==c;if(p&&x!==0)return;const m=new We(f.name,f.lodThreshold,[0,0,0]);f.parts.forEach((h=>{const g=p?new C({},s):Qe(a,h,m,r,o,l,e,s,d),{geometry:b,vertexCount:y}=Xe(h,g??new C({},s)),$=b.boundingInfo;$!=null&&x===0&&(H(u,$.bbMin),H(u,$.bbMax)),g!=null&&(m.stageResources.geometries.push(b),m.numberOfVertices+=y)})),p||i.push(m)})),{engineResources:i,referenceBoundingBox:u}}function Qe(t,r,o,s,c,d,a,i,l){var y,$;const e=t.materials.get(r.material);if(e==null)return null;const{normal:n,color:u,texCoord0:f,tangent:x}=r.attributes,p=r.material+(n?"_normal":"")+(u?"_color":"")+(f?"_texCoord0":"")+(x?"_tangent":""),m=r.attributes.texCoord0!=null,h=r.attributes.normal!=null,g=Ze(e.alphaMode);if(!d.has(p)){if(m){const B=(E,ie=!1,le=!1)=>{if(E!=null&&!a.has(E)){const P=t.textures.get(E);if(P){const R=P.data,ue=ie&&!L(R)?i.compressionOptions:void 0;a.set(E,new Fe(L(R)?R.data:R,{...P.parameters,preMultiplyAlpha:!L(R)&&le,encoding:L(R)?R.encoding:void 0,compressionOptions:ue}))}}},ae=g!==O.Opaque&&!l;B(e.colorTexture,ae,g!==O.Opaque),B(e.normalTexture),B(e.occlusionTexture,!0),B(e.emissiveTexture),B(e.metallicRoughnessTexture,!0)}const T=1/te,v=e.color[0]**T,j=e.color[1]**T,V=e.color[2]**T,se=e.emissiveFactor[0]**T,oe=e.emissiveFactor[1]**T,ne=e.emissiveFactor[2]**T,_=e.colorTexture!=null&&m?a.get(e.colorTexture):null,U=we(e),N=((y=e.normalTextureTransform)==null?void 0:y.scale)!=null?($=e.normalTextureTransform)==null?void 0:$.scale:ve;d.set(p,new C({...s,customDepthTest:Me.Lequal,textureAlphaMode:g,textureAlphaCutoff:e.alphaCutoff,diffuse:[v,j,V],ambient:[v,j,V],opacity:e.alphaMode==="OPAQUE"?1:e.opacity,doubleSided:e.doubleSided,doubleSidedType:"winding-order",cullFace:e.doubleSided?Q.None:Q.Back,hasVertexColors:!!r.attributes.color,hasVertexTangents:!!r.attributes.tangent,normalType:h?G.Attribute:G.ScreenDerivative,castShadows:!0,receiveShadows:e.receiveShadows,receiveAmbientOcclusion:e.receiveAmbientOcclusion,textureId:_!=null?_.id:void 0,colorMixMode:e.colorMixMode,normalTextureId:e.normalTexture!=null&&m?a.get(e.normalTexture).id:void 0,textureAlphaPremultiplied:_!=null&&!!_.parameters.preMultiplyAlpha,occlusionTextureId:e.occlusionTexture!=null&&m?a.get(e.occlusionTexture).id:void 0,emissiveTextureId:e.emissiveTexture!=null&&m?a.get(e.emissiveTexture).id:void 0,metallicRoughnessTextureId:e.metallicRoughnessTexture!=null&&m?a.get(e.metallicRoughnessTexture).id:void 0,emissiveBaseColor:[se,oe,ne],mrrFactors:U?Be:[e.metallicFactor,e.roughnessFactor,s.mrrFactors[2]],isSchematic:U,colorTextureTransformMatrix:A(e.colorTextureTransform),normalTextureTransformMatrix:A(e.normalTextureTransform),scale:[N[0],N[1]],occlusionTextureTransformMatrix:A(e.occlusionTextureTransform),emissiveTextureTransformMatrix:A(e.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:A(e.metallicRoughnessTextureTransform),...c},i))}const b=d.get(p);if(o.stageResources.materials.push(b),m){const T=v=>{v!=null&&o.stageResources.textures.push(a.get(v))};T(e.colorTexture),T(e.normalTexture),T(e.occlusionTexture),T(e.emissiveTexture),T(e.metallicRoughnessTexture)}return b}function Xe(t,r){const o=t.attributes.position.count,s=Ne(t.indices||o,t.primitiveType),c=I(3*o),{typedBuffer:d,typedBufferStride:a}=t.attributes.position;Se(c,d,t.transform,3,a);const i=[[M.POSITION,new S(c,s,3,!0)]];if(t.attributes.normal!=null){const e=I(3*o),{typedBuffer:n,typedBufferStride:u}=t.attributes.normal;Ae(w,t.transform),Oe(e,n,w,3,u),X(w)&&Z(e,e),i.push([M.NORMAL,new S(e,s,3,!0)])}if(t.attributes.tangent!=null){const e=I(4*o),{typedBuffer:n,typedBufferStride:u}=t.attributes.tangent;_e(w,t.transform),Ue(e,n,w,4,u),X(w)&&Z(e,e,4),i.push([M.TANGENT,new S(e,s,4,!0)])}if(t.attributes.texCoord0!=null){const e=I(2*o),{typedBuffer:n,typedBufferStride:u}=t.attributes.texCoord0;ke(e,n,2,u),i.push([M.UV0,new S(e,s,2,!0)])}const l=t.attributes.color;if(l!=null){const e=new Uint8Array(4*o);l.elementCount===4?l instanceof ee?Y(e,l,1,255):(l instanceof Ee||l instanceof Ie)&&Y(e,l,1/255,255):(e.fill(255),l instanceof K?z(e,l.typedBuffer,1,255,4,l.typedBufferStride):(t.attributes.color instanceof Le||t.attributes.color instanceof Pe)&&z(e,l.typedBuffer,1/255,255,4,t.attributes.color.typedBufferStride)),i.push([M.COLOR,new S(e,s,4,!0)])}return{geometry:new qe(r,i),vertexCount:o}}const w=J();function Ze(t){switch(t){case"BLEND":return O.Blend;case"MASK":return O.Mask;case"OPAQUE":case null:case void 0:return O.Opaque}}function ze(t,r){for(let o=0;o<t.model.lods.length;++o){const s=t.model.lods[o];for(const c of s.parts){const d=c.attributes.normal;if(d==null)return;const a=c.attributes.position,i=a.count,l=F(),e=F(),n=F(),u=new Float32Array(4*i),f=new Float32Array(3*i),x=Te(he(),c.transform);let p=0,m=0;for(let h=0;h<i;h++){a.getVec(h,e),d.getVec(h,l),D(e,e,c.transform),ge(n,e,r.center),W(n,n,r.radius);const g=n[2],b=be(n),y=Math.min(.45+.55*b*b,1)**te;W(n,n,r.radius),x!==null&&D(n,n,x),ye(n,n),o+1!==t.model.lods.length&&t.model.lods.length>1&&Re(n,n,l,g>-1?.2:Math.min(-4*g-3.8,1)),f[p]=n[0],f[p+1]=n[1],f[p+2]=n[2],p+=3,u[m]=y,u[m+1]=y,u[m+2]=y,u[m+3]=1,m+=4}c.attributes.normal=new K(f),c.attributes.color=new ee(u)}}}const rt=Object.freeze(Object.defineProperty({__proto__:null,fetch:He,parseUrl:re},Symbol.toStringTag,{value:"Module"}));export{He as Y,rt as o,A as s};
