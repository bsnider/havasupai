import{r as s,m as r,d as b,e as vt,ae as kt,h as Jt,dm as Vt,er as St,kO as _t,aT as Qt,aU as ke,qg as Ve,sN as Se,iB as Z,AK as wt,eG as at,fm as Ce,fq as Pe,aV as st,AL as Me,AM as Ie,aM as xt,$ as Xt,AN as H,AO as te,AP as Ee,uw as lt,AQ as Re,uk as D,AR as ee,AS as Ue,AT as ie,ug as Ae,ny as De,uv as Ge,AU as He,AV as ne,ue as oe,AW as Ze,kg as ze,ui as J,is as I,ft as Fe,AX as Le,gm as Ne,AY as Be,AZ as je,sj as qe,aL as se,aN as Ot,no as re,jr as We,ek as Ye,ap as R,A_ as Ct,av as nt,u as G,aa as Ke,at as X,aq as Je,kj as Pt,A$ as ae,B0 as Qe,bc as Xe,B1 as ti,x$ as ei,ed as Mt,bK as It,mv as le,fY as ii,an as ni,fv as ce,f8 as oi,x5 as pe,f7 as si,t2 as ri,bg as N,fc as B,uC as Et,B2 as ai,B3 as li,ig as ci,pa as pi,pc as Rt,B4 as ct,dJ as ui,iC as Ut,p6 as At,aW as Dt,zS as Gt}from"./index-DtL3GvY-.js";import{r as E,V as di,R as hi,E as gi,c as mi,H as yi}from"./SketchTooltipInfo-135ae0Qc.js";import{a as ot,i as gt}from"./dehydratedFeatureComparison-D1x3VWnM.js";import{F as fi,k as Ht,v as vi,b as Zt,U as _i,T as wi,j as zt,R as xi}from"./createUtils-CYD0URqB.js";import{h as Q,k as Oi,R as $i,y as ue,F as de,Q as bi,w as Ti}from"./TooltipInfoWithCoordinates-DacFrjxv.js";import{n as ki,p as mt,D as Vi}from"./InteractiveToolBase-BrCFa2VJ.js";import{t as Si}from"./ReactiveSet-WBi7bpkM.js";import{P as Ci,E as Pi,p as Mi,b as Ii,t as Ei,c as Ri,d as Ui,f as Ai}from"./EditGeometryOperations-B8ZqwVEI.js";import{e as Ft}from"./SnappingContext-B6FttRAO.js";import{f as Di}from"./SnappingDragPipelineStep-CVqMnd58.js";import{p as Gi}from"./SnappingOperation-C6PQauFH.js";var O;(function(i){i[i.NeverApplied=0]="NeverApplied",i[i.Applied=1]="Applied",i[i.Undone=2]="Undone"})(O||(O={}));var S;(function(i){i.UndoRedoUpdating="UndoRedoUpdating",i.UndoInvalidError="UndoInvalidError",i.RedoInvalidError="RedoInvalidError",i.ApplyInvalidError="ApplyInvalidError"})(S||(S={}));const pt={[S.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[S.UndoInvalidError]:"There are no items to Undo",[S.RedoInvalidError]:"There are no items to Redo",[S.ApplyInvalidError]:"Cannot apply an item that is already applied"};let j=class extends Error{constructor(){super(pt[S.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},ft=class extends Error{constructor(){super(pt[S.UndoInvalidError]),this.type="undo-redo-undo-error"}},Lt=class extends Error{constructor(){super(pt[S.RedoInvalidError]),this.type="undo-redo-redo-error"}},Hi=class extends Error{constructor(){super(pt[S.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var P;(function(i){i[i.Apply=0]="Apply",i[i.Undo=1]="Undo",i[i.Redo=2]="Redo"})(P||(P={}));let tt=class extends vt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=O.NeverApplied}get canUndo(){return this.status===O.Applied}get canRedo(){return this.status===O.Undone}async executeUndoRedoOperation(t){switch(t){case P.Apply:if(this.status!==O.NeverApplied)throw new Hi;return await this.apply(),void(this.status=O.Applied);case P.Undo:if(this.status!==O.Applied)throw new ft;return await this.undo(),void(this.status=O.Undone);case P.Redo:if(this.status!==O.Undone)throw new ft;return await this.redo(),void(this.status=O.Applied)}}};s([r()],tt.prototype,"name",void 0),s([r()],tt.prototype,"tag",void 0),tt=s([b("esri.undoredo.UndoableOperation")],tt);let k=class extends vt{constructor(){super(...arguments),this._stack=new kt,this._stackPosition=-1,this._updatingHandles=new Jt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new ft;if(this.updating)throw new j;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(P.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Lt;if(this.updating)throw new j;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Lt;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(P.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new j;await this._updatingHandles.addPromise((async()=>{t.status===O.NeverApplied&&await t.executeUndoRedoOperation(P.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((e=>e.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new j;await this._updatingHandles.addPromise((async()=>{t.status===O.NeverApplied&&await t.executeUndoRedoOperation(P.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await Vt((()=>!this.updating));const n=new kt;for(let o=0;o<this._stack.length;o++){const c=this._stack.getItemAt(o);c&&(c.tag===t?(c.destroy(),o===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(c))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(t=!1){if(this.updating&&!t)throw new j;await Vt((()=>!this.updating)),this._drainStack()}};s([r()],k.prototype,"_stack",void 0),s([r()],k.prototype,"_stackPosition",void 0),s([r()],k.prototype,"updating",null),s([r({readOnly:!0})],k.prototype,"canUndo",null),s([r({readOnly:!0})],k.prototype,"hasUndo",null),s([r({readOnly:!0})],k.prototype,"canRedo",null),s([r({readOnly:!0})],k.prototype,"hasRedo",null),k=s([b("esri.UndoRedo")],k);let Zi=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function z(i,t,e){if(i==null)return"noTool";switch(i){case"point":return zi();case"multipoint":return"multipoint";case"polyline":return Fi(t,e);case"polygon":return Li(t,e);case"rectangle":case"circle":return Ni(t,e);default:return}}function zi(i){return"point"}function Fi(i,t){const e=i!=null&&i.type==="polyline"&&i.paths.length?i.paths[0].length:0;return t==="freehand"?e<2?"freehandStart":"freehandEnd":e<2?"polylineZeroVertices":"polylineOneVertex"}function Li(i,t){const e=i!=null&&i.type==="polygon"&&i.rings.length?i.rings[0].length:0;if(e<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(e<4)return t==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ni(i,t){if((i!=null&&i.type==="polygon"&&i.rings.length?i.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function Bi(i,t){const e=i==null?void 0:i.geometry;if(!i||(e==null?void 0:e.type)!=="mesh"||!t)return;const{renderCoordsHelper:n,elevationProvider:o}=t,{camera:c}=t.state,{extent:l}=e,{center:u,spatialReference:a}=l,p=St(a),d=_t(a),y=St(n.spatialReference),w=l.width*p,f=l.height*d,g=(l.zmax??0)*d,x=g-(l.zmin??0)*d,T=Math.max(w,f,x)/y,{x:v,y:_}=u,M=u.z??0;Qt(et,v,_,M),n.toRenderCoords(et,a,et);const L=T/c.computeScreenPixelSizeAt(et);if(L>c.width*qi)return"meshTooClose";if(L<ji)return"meshTooFar";const be=Ve(i),{absoluteZ:Te}=Se(v,_,g,a,t,be);return Te<(o.getElevation(v,_,M,a,"ground")??0)*d+x*Wi?"meshUnderground":"mesh"}const ji=20,qi=1,Wi=.1,et=ke();function Yi(i,t,e,n,o,c){let l="geodesic",u=Ie(e);const a=Z();return wt(i,t,n,a),a[2]=0,u&&at(a,e,a,u)||(l="euclidean",u=e),{mode:l,view:t,elevationInfo:n,hasZ:o,directionMode:c,spatialReference:i.spatialReference,measurementSR:u,origin:a}}function Ki(i,t,e){if(t==null||i==null)return;const n=Ee(e.measurementSR);if(n==null)return;const o=ut(i,e);if(o==null)return;const c=lt(t,n);return new Re(o,c)}function Ji(i,t,e,n){if(e==null||i==null)return;const o=ut(i,n);if(o==null)return;const c=H(e),l=10,u=p=>{if(p==null)return;const d=Z(),y=Ae(p,"degrees","geographic");return Ge(d,o,n.measurementSR,l,y,n.mode)?new De(o,d):void 0},a=()=>{if(t!=null&&i!=null)return H(ie(t,i))};switch(n.directionMode){case D.Absolute:return u(c);case D.Relative:{const p=a();return p==null?void 0:u(p+c)}case D.RelativeBilateral:{const p=a();return p==null?void 0:ee([u(p+c),u(p-c)])}}}function he(i,t){const e=dt(i,t);return e!=null?new Ue(e):void 0}function ge(i,t,e){const{context:n,longitude:o,latitude:c,direction:l,distance:u,elevation:a}=e;if(o!=null||c!=null||u!=null||a!=null||l!=null){if(o!=null||c!=null){const p=H(o),d=H(c),y=dt(a,n);return new te(p,d,y)}return Qi(i,t,e)}}function Qi(i,t,{context:e,direction:n,distance:o,elevation:c}){if(t==null)return he(c,e);const{view:l,elevationInfo:u,measurementSR:a}=e,p=wt(t,l,u);if(!a||!at(p,t.spatialReference,Nt,a))return;const[d,y]=Nt,w=o!=null?lt(o,"meters"):void 0,f=H(n),g=dt(c,e),x=v=>{const _=new Ze([d,y],a,w,g,v);return w==null||v==null||g==null&&e.hasZ?_:new ze(_.closestTo(p))};if(f==null)return x(void 0);const T=()=>{if(i!=null&&t!=null)return H(ie(i,t))};switch(e.directionMode){case D.Absolute:return x(f);case D.Relative:{const v=T();return v==null?void 0:x(v+f)}case D.RelativeBilateral:{const v=T();return v==null?void 0:ee([x(v+f),x(v-f)])}}}function Xi(i){return i.context.mode==="geodesic"?ge(null,null,i):me(i)}function tn(i,t,e){const{context:n,x:o,y:c,distance:l,direction:u,elevation:a}=e;return n.mode==="geodesic"?ge(t,i,e):o!=null||c!=null?me(e):en([Ki(i,l,n),Ji(i,t,u,n),he(a,n)])}function me({x:i,y:t,elevation:e,context:n}){it.x=(i==null?void 0:i.value)??0,it.y=(t==null?void 0:t.value)??0,it.spatialReference=n.spatialReference;const o=ut(it,n,sn);return new te(i!=null&&o!=null?o[0]:void 0,t!=null&&o!=null?o[1]:void 0,dt(e,n))}function en(i){let t;for(const e of i)e&&(t=(t==null?void 0:t.intersect(e))??e);return t}function ut(i,t,e=Z()){const{view:n,elevationInfo:o,measurementSR:c,origin:l,mode:u}=t;if(wt(i,n,o,e),at(e,i.spatialReference,e,c))return u!=="geodesic"&&Ce(e,e,l),e}function nn(i,t,e,n){const{view:o,measurementSR:c,spatialReference:l,origin:u,mode:a}=e;if(a==="geodesic"?Pe(q,i):st(q,i,u),at(q,c,q,l))return Me(q,o,t,e,n)}function dt(i,t){var e;return((e=on(i,t))==null?void 0:e.value)??void 0}function on(i,{view:t,origin:e,elevationInfo:n,hasZ:o,measurementSR:c}){if(i==null||!o)return;const l=He(c);if(l==null)return;const[u,a]=e,p=lt(i,l),d=(t==null?void 0:t.type)==="3d"?ne(t,u,a,p,c,n):p;return d!=null?oe(d,l):void 0}const Nt=Z(),sn=Z(),q=Z(),it=xt(0,0,0,Xt.WGS84);let V=class extends E{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=J}get allFields(){return[]}};s([r()],V.prototype,"type",void 0),s([r()],V.prototype,"radius",void 0),s([r()],V.prototype,"xSize",void 0),s([r()],V.prototype,"ySize",void 0),s([r()],V.prototype,"area",void 0),s([r()],V.prototype,"helpMessage",void 0),s([r()],V.prototype,"allFields",null),V=s([b("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],V);let W=class extends Q(E){constructor(t){super(t),this.type="draw-mesh",this.orientation=Oi({lockable:!1}),this.scale=$i({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};s([r()],W.prototype,"helpMessage",void 0),s([r()],W.prototype,"allFields",null),W=s([b("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],W);let Y=class extends Q(E){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};s([r()],Y.prototype,"helpMessage",void 0),s([r()],Y.prototype,"allFields",null),Y=s([b("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],Y);let K=class extends Q(E){constructor(i){super(i),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};s([r()],K.prototype,"helpMessage",void 0),s([r()],K.prototype,"allFields",null),K=s([b("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],K);let U=class extends Q(E){constructor(t){super(t),this.type="draw-polygon",this.direction=ue(),this.distance=de(),this.area=bi(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};s([r()],U.prototype,"xyMode",void 0),s([r()],U.prototype,"helpMessage",void 0),s([r()],U.prototype,"allFields",null),U=s([b("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],U);let A=class extends Q(E){constructor(t){super(t),this.type="draw-polyline",this.direction=ue(),this.distance=de(),this.totalLength=Ti(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};s([r()],A.prototype,"helpMessage",void 0),s([r()],A.prototype,"xyMode",void 0),s([r()],A.prototype,"allFields",null),A=s([b("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],A);let C=class extends E{constructor(i){super(i),this.type="draw-rectangle",this.xSize=I,this.ySize=I,this.area=J}get allFields(){return[]}};s([r()],C.prototype,"type",void 0),s([r()],C.prototype,"xSize",void 0),s([r()],C.prototype,"ySize",void 0),s([r()],C.prototype,"area",void 0),s([r()],C.prototype,"helpMessage",void 0),s([r()],C.prototype,"allFields",null),C=s([b("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],C);function rn(i,t){return{point:new K({sketchOptions:t,viewType:i}),multipoint:new Y({sketchOptions:t,viewType:i}),polyline:new A({sketchOptions:t,viewType:i}),polygon:new U({sketchOptions:t,viewType:i}),mesh:new W({sketchOptions:t,viewType:i}),rectangle:new C({sketchOptions:t}),circle:new V({sketchOptions:t})}}function Bt(i){const{directionOptions:t,geometryType:e,sketchOptions:n,tooltipInfos:o}=i,c=u=>{const a=ht(i).mode,p=o[u].elevation;a==="relative-to-ground"||a==="relative-to-scene"||a==="on-the-ground"?p.lock(Tt(i)):p.unlock()},l=u=>{if(t){const a=o[u].direction;a.committed=t.angle,a.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}};switch(e){case"polygon":case"polyline":c(e),l(e);break;case"point":case"mesh":c(e)}}function an(i,t){const{drawOperation:e,view:n}=t,o=$t(t),c=ht(t);if(n.type==="2d"||!i||c.mode!=="absolute-height"||(e==null?void 0:e.numCommittedVertices)!==1||!o||o.type!=="draw-polyline"&&o.type!=="draw-polygon"||o.elevation.locked)return;const[l,u,a]=i,p=wn(l,u,a,c,t);p!=null&&o.elevation.lock(p)}function jt(i){var t;(t=$t(i))==null||t.allFields.forEach((e=>{e.unlockOnVertexPlacement&&e.unlock()}))}function $t({geometryType:i,graphic:t,tooltipInfos:e}){var n;return((n=t==null?void 0:t.geometry)==null?void 0:n.type)!==ln[i]?i==="circle"||i==="rectangle"?e[i]:null:e[i]}const ln={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function cn(i,t){switch(i==null?void 0:i.type){case"draw-point":pn(i,t);break;case"draw-multipoint":un(i,t);break;case"draw-polyline":hn(i,t);break;case"draw-polygon":gn(i,t);break;case"draw-rectangle":yn(i,t);break;case"draw-circle":fn(i,t);break;case"draw-mesh":dn(i,t)}}function pn(i,t){var n;const e=(n=t.graphic)==null?void 0:n.geometry;(e==null?void 0:e.type)==="point"&&(bt(i,e,t),i.helpMessage=z("point",e,t.drawOperation.drawingMode))}function un(i,t){var n;const e=(n=t.graphic)==null?void 0:n.geometry;(e==null?void 0:e.type)==="multipoint"&&(bt(i,e,t),i.helpMessage=z("multipoint",e,t.drawOperation.drawingMode))}function dn(i,t){const{graphic:e,view:n}=t,o=e==null?void 0:e.geometry;n.type!=="3d"||o&&o.type!=="mesh"||(bt(i,o==null?void 0:o.origin,t),o&&di(i,o),i.helpMessage=Bi(e,n))}function bt(i,t,e){const{drawOperation:n,view:o,sketchOptions:c}=e,{cursorVertex:l}=n;i.sketchOptions=c,i.viewType=o.type;const u=(t==null?void 0:t.type)==="multipoint"?t.getPoint(t.points.length-1):t;if(i.setLocationFromPoint(u,F(e)),fe(i.elevation,e),!l)return void(n.constraints=void 0);const a=l;n.constraints={context:xe(a,e),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:null,direction:null}}function hn(i,t){const{createOperationGeometry:e,drawOperation:n,automaticLengthMeasurementUtils:o}=t,c=e!=null?e.full:null;c&&c.type!=="polyline"||(ye(i,t),i.totalLength.actual=n.lastVertex?(c?o.autoLength2D(c):null)??I:null,i.helpMessage=z("polyline",c,t.drawOperation.drawingMode))}function gn(i,t){const{createOperationGeometry:e,drawOperation:n}=t,o=e!=null?e.full:null;o&&o.type!=="polygon"||(ye(i,t),i.area.actual=n.lastVertex?(o?t.automaticAreaMeasurementUtils.autoArea2D(o):null)??J:null,i.helpMessage=z("polygon",o,t.drawOperation.drawingMode))}const qt=Ne(se);function ye(i,t){const{drawOperation:e,sketchOptions:n,view:o,automaticLengthMeasurementUtils:c}=t,{cursorVertex:l,lastVertex:u,secondToLastVertex:a}=e,p=n.values.effectiveDirectionMode;i.sketchOptions=n,i.viewType=o.type;const d=u&&l?c.autoDistanceBetweenPoints2D(qt(u),qt(l))??I:null;if(i.distance.actual=d,i.distance.readOnly=u==null,i.direction.actual=null,i.direction.readOnly=!0,u&&l&&(p==="absolute"||a)){const f=Be(a,u,l,p);i.direction.actual=f??je,i.direction.readOnly=!1}i.setLocationFromPoint(l,F(t)),fe(i.elevation,t);const y=mn(u,t);i.xyMode=y,i.direction.visible=y==="direction-distance",i.distance.visible=y==="direction-distance",i.effectiveX.visible=y==="coordinates",i.effectiveY.visible=y==="coordinates";const w=l??u;e.constraints=w?{context:xe(w,t),x:i.x.committed,y:i.y.committed,longitude:i.longitude.committed,latitude:i.latitude.committed,elevation:i.elevation.committed,distance:i.distance.committed,direction:i.direction.committed}:void 0}function mn(i,{sketchOptions:t}){const e=t.tooltips.xyMode;return e==="auto"?i?"direction-distance":"coordinates":e}function yn(i,t){var e;i.sketchOptions=t.sketchOptions,i.xSize=_e(t),i.ySize=we(t),i.area=ve(t),i.helpMessage=z("rectangle",(e=t.graphic)==null?void 0:e.geometry,t.drawOperation.drawingMode)}function fn(i,t){var o;const{forceUniformSize:e,sketchOptions:n}=t;i.sketchOptions=n,i.radius=e?vn(t):null,i.xSize=e?null:_e(t),i.ySize=e?null:we(t),i.area=ve(t),i.helpMessage=z("circle",(o=t.graphic)==null?void 0:o.geometry,t.drawOperation.drawingMode)}function fe(i,t){const{drawOperation:e}=t,n=(e==null?void 0:e.cursorVertex)??(e==null?void 0:e.lastVertex);i.actual=qe(n)??Tt(t),i.visible=e.hasZ,i.readOnly=!1,i.showAsZ=!0}function ve(i){var e;const t=(e=i.createOperationGeometry)==null?void 0:e.full;return(t==null?void 0:t.type)!=="polygon"?J:i.automaticAreaMeasurementUtils.autoArea2D(t)??J}function _e({createOperationGeometry:i,automaticLengthMeasurementUtils:t}){var n;const e=(n=i==null?void 0:i.rectangle)==null?void 0:n.midpoints;return(e!=null?t.autoDistanceBetweenPoints2D(e.left,e.right):null)??I}function we({createOperationGeometry:i,automaticLengthMeasurementUtils:t}){var n;const e=(n=i==null?void 0:i.rectangle)==null?void 0:n.midpoints;return(e!=null?t.autoDistanceBetweenPoints2D(e.top,e.bottom):null)??I}function vn({createOperationGeometry:i,automaticLengthMeasurementUtils:t}){var e;return(((e=i==null?void 0:i.circle)==null?void 0:e.center)!=null&&i.circle.edge!=null?t.autoDistanceBetweenPoints2D(i.circle.center,i.circle.edge):null)??I}function _n(i){const{geometryType:t,tooltipInfos:e}=i;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const n=e[t].elevation.committed;return n?lt(n,"meters")/_t(F(i)):void 0}default:return}}function wn(i,t,e,n,o){const{view:c,drawOperation:l}=o;if(c.type!=="3d"||!l)return;e??(e=0);const u=F(o),a=ht(o),p=ne(c,i,t,e,u,a,n);return Le(p,u)??Tt(o)}function ht(i){return i.drawOperation.elevationInfo??Fe}function F(i){return i.drawOperation.coordinateHelper.spatialReference}function Tt(i){const t=_t(F(i));return oe(i.defaultZ*t,"meters")}function xe(i,t){return Yi(i,t.view,F(t),ht(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}let m=class extends Ot.EventedMixin(ki){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new re}initialize(){const{view:t}=this;this.internalGraphicsLayer=new We({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=rn(t.type,this.sketchOptions);const n=hi((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=n,Bt(this._tooltipsContext),this._coordinateFormatterLoadTask=Ye((()=>gi())),this.addHandles([e.on("vertex-add",(o=>this.onVertexAdd(o))),e.on("vertex-remove",(o=>this.onVertexRemove(o))),e.on("vertex-update",(o=>this.onVertexUpdate(o))),e.on("cursor-update",(o=>this.onCursorUpdate(o))),e.on("cursor-remove",(()=>this._updateGraphic())),e.on("complete",(o=>this.onComplete(o))),this._coordinateFormatterLoadTask,n.on("paste",(o=>mi(o,this.activeTooltipInfo))),R((()=>this.cursor),(o=>{e.cursor=o}),nt),Ct((()=>{const{activeTooltipInfo:o,sketchOptions:c}=this;cn(o,this._tooltipsContext),n.info=c.tooltips.effectiveEnabled?o:null})),Ct((()=>{e.constraintZ=_n(this._tooltipsContext)}),Je)]),this.finishToolCreation()}destroy(){this.drawOperation=G(this.drawOperation),this.tooltip=G(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=G(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:e,drawOperation:n,forceUniformSize:o,geometryType:c,graphic:l,sketchOptions:u,tooltipInfos:a,view:p,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:y}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:e,drawOperation:n,forceUniformSize:o,geometryType:c,graphic:l,sketchOptions:u,tooltipInfos:a,view:p,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:y}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof k?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||yi(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Bt(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles($.outline),this.removeHandles($.regularVertices),this.removeHandles($.activeVertex),this.removeHandles($.activeEdge),this.removeHandles(yt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Ke({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(X((()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)})),yt),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var T,v;if(this.drawOperation==null)return;const{coordinateHelper:e,view:n,visualizationCursorVertex:o,lastVertex:c,committedVertices:l,geometryIncludingUncommittedVertices:u,numCommittedVertices:a}=this.drawOperation;if(!(a>0||o!=null))return;const p=t.operationComplete?l:u,d=p.length,y=o!=null?e.pointToArray(o):null,w=this._drawSpatialReference,f=n.type==="3d"&&n.viewingMode==="global",g=new Zi;g.committedVertices=l,g.cursorVertex=y;const{geometryType:x}=this;switch(x){case"point":case"mesh":g.full=e.arrayToPoint(p[0]);break;case"multipoint":g.full=d>0?xi(p,w):null;break;case"polyline":case"polygon":d>0&&(g.full=x==="polygon"?wi([p],w,f,!0):zt([p],w,f),g.cursorEdge=y!=null&&c&&!ot(o,c)?zt([[y,e.pointToArray(c)]],w,f):null,g.outline=d>1?g.full:null);break;case"circle":case"rectangle":{if(g.committedVertices=g.cursorVertex=null,!d)break;const _=fi(n,p[0]),M=p[0],L=_.makeMapPoint(M[0]+xn*n.resolution,M[1]);x==="circle"?d===1&&t.operationComplete?g.circle=Ht([M,L],_,!0):d===2&&(this.forceUniformSize?g.circle=Ht(p,_,this.centered):g.rectangle=vi(p,_,this.centered)):d===1&&t.operationComplete?g.rectangle=Zt([M,L],_,!0):d===2&&(g.rectangle=this.forceUniformSize?Zt(p,_,this.centered):_i(p,_,this.centered)),g.full=g.circle!=null?g.circle.geometry:(T=g.rectangle)==null?void 0:T.geometry,g.outline=((v=g.full)==null?void 0:v.type)==="polygon"?g.full:null;break}default:return null}return g}initializeGraphic(t){return X()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(e=this._createOrUpdateGraphic(n.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return X()}onCursorEdgeChanged(t){return X()}onVertexAdd(t){var e;jt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||an((e=t.vertices.at(0))==null?void 0:e.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){jt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),$.activeEdge):this.removeHandles($.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),$.outline):this.removeHandles($.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),$.regularVertices):this.removeHandles($.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),$.activeVertex):this.removeHandles($.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(yt)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?$t(this._tooltipsContext):null}};s([r()],m.prototype,"_coordinateFormatterLoadTask",void 0),s([r()],m.prototype,"_createOperationGeometry",void 0),s([r()],m.prototype,"_tooltipsContext",null),s([r({value:!0})],m.prototype,"centered",null),s([r()],m.prototype,"cursor",null),s([r({nonNullable:!0})],m.prototype,"defaultZ",void 0),s([r({constructOnly:!0})],m.prototype,"directionOptions",void 0),s([r()],m.prototype,"drawOperation",void 0),s([r()],m.prototype,"elevationLockOnVertexAddDisabled",void 0),s([r({value:!0})],m.prototype,"enabled",null),s([r({value:!0})],m.prototype,"forceUniformSize",null),s([r({constructOnly:!0})],m.prototype,"geometryType",void 0),s([r()],m.prototype,"graphic",null),s([r({constructOnly:!0})],m.prototype,"graphicProperties",void 0),s([r()],m.prototype,"graphicSymbol",null),s([r({constructOnly:!0})],m.prototype,"hasZ",void 0),s([r({constructOnly:!0})],m.prototype,"geometryToPlace",void 0),s([r()],m.prototype,"mode",null),s([r()],m.prototype,"snappingManager",void 0),s([r()],m.prototype,"snapToScene",void 0),s([r()],m.prototype,"tooltip",void 0),s([r()],m.prototype,"tooltipInfos",void 0),s([r({constructOnly:!0,type:re})],m.prototype,"sketchOptions",void 0),s([r()],m.prototype,"updating",null),s([r({constructOnly:!0,nonNullable:!0})],m.prototype,"view",void 0),s([r({constructOnly:!0})],m.prototype,"automaticAreaMeasurementUtils",void 0),s([r({constructOnly:!0})],m.prototype,"automaticLengthMeasurementUtils",void 0),s([r({constructOnly:!0})],m.prototype,"undoRedo",null),s([r()],m.prototype,"activeTooltipInfo",null),m=s([b("esri.views.draw.DrawGraphicTool")],m);const yt=Symbol("create-operation-graphic"),$={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Xn(i){switch(i){case"point":case"polyline":case"polygon":case"multipoint":return i;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const xn=48,Oe="click";class On{constructor({consumesClicks:t,grabbableForEvent:e}){this.events=new Ot,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=e}destroy(){}intersectionDistance(t,e){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}const $n="crosshair",bn="progress",Wt=Symbol(),Yt=Symbol();let h=class extends Ot.EventedMixin(vt){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Si,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Jt,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Pt(Xi),this._getPolylineOrPolygonConstraint=Pt(tn),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new ae,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=Qe(!!t.hasZ))}initialize(){const{geometryType:t,view:e}=this,n=e.spatialReference,o="viewingMode"in e.state?e.state.viewingMode:Xe.Local,c=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=Ci(this.hasZ,this.hasM,n),this._editGeometryOperations=new Pi(new Mi(c,this.coordinateHelper),o),this._snappingOperation=new Gi({view:e}),this.addHandles([R((()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint})),(({stagedPoint:a,constraint:p},d)=>{const{snappingOptions:y}=this;if(y&&(y.forceDisabled=p!=null&&ti(p)),d!=null&&a===d.stagedPoint&&p!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(a??this._screenToMap(this._stagedScreenPoint))}),{equals:(a,p)=>a.stagedPoint===p.stagedPoint&&ii(a.constraint,p.constraint)}),R((()=>this.view.viewpoint),((a,p)=>{a&&p&&ni(a,p)&&this._onKeyboardBasedChange()}))]),this._activeComponent=new Ii(n,o),this._editGeometryOperations.data.components.push(this._activeComponent);const l=this.segmentLabels;l!=null&&(l.context={view:e,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(R((()=>this.labelOptions.enabled),(a=>{l.visible=a}),nt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(a=>{var g,x,T,v;const p=a.vertices.map((_=>({componentIndex:0,vertexIndex:_.index,coordinates:this.coordinateHelper.vectorToArray(_.pos)}))),d=p.map((_=>_.coordinates)),y=this.coordinateHelper.vectorToDehydratedPoint((g=this._activeComponent.getFirstVertex())==null?void 0:g.pos)??null;ot(y,this.firstVertex)||(this.firstVertex=y);const w=this.coordinateHelper.vectorToDehydratedPoint((x=this._activeComponent.getLastVertex())==null?void 0:x.pos)??null;ot(w,this.lastVertex)||(this.lastVertex=w);const f=this.coordinateHelper.vectorToDehydratedPoint((v=(T=this._activeComponent.edges.at(-1))==null?void 0:T.leftVertex)==null?void 0:v.pos)??null;switch(ot(f,this.secondToLastVertex)||(this.secondToLastVertex=f),this._processCursor(this.cursorVertex),a.type){case"vertex-add":this.emit(a.type,{...a,added:d,vertices:p});break;case"vertex-update":this.emit(a.type,{...a,updated:d,vertices:p});break;case"vertex-remove":this.emit(a.type,{...a,removed:d,vertices:p})}})));const u=this._manipulator=new On({consumesClicks:!1,grabbableForEvent:a=>this.drawingMode!=="click"||a.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(u),u.grabbable=t!=="point"&&t!=="multipoint",this.addHandles([u.events.on("immediate-click",(a=>this._onImmediateClick(a))),u.events.on("immediate-double-click",(a=>this._onImmediateDoubleClick(a))),R((()=>this.drawingMode),(()=>{this.removeHandles(Wt),this.addHandles(this._createManipulatorDragPipeline(u),Wt)}),nt),R((()=>({effectiveCursor:this.effectiveCursor})),(({effectiveCursor:a})=>{u.cursor=a}),nt)]),ei(this,(()=>{const a=this.view.inputManager.latestPointerType??"mouse",p=this._getSnappingContext(a);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,p);this._updatingHandles.addPromise(Mt(d))}}))}destroy(){G(this.segmentLabels),G(this._snappingOperation),this._editGeometryOperations=G(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:e}=this;return t!=null&&this._pointerDownStates.has(t)||e.grabbing||!e.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((t=>this.coordinateHelper.vectorToArray(t.pos)))}get _constraint(){const{constraints:t,constraintsEnabled:e}=this;if(t&&e)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??Oe)}get effectiveCursor(){return this.loading?bn:this._hideDefaultCursor?null:this.cursor||$n}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:e,firstVertex:n,geometryType:o}=this;return o==="polygon"&&gt(t,n)||gt(t,e)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:e,coordinateHelper:n}=this,o=t.slice();return e!=null&&o.push(n.pointToArray(e)),o}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){var l;const e=(t==null?void 0:t.aborted)||!1;this._snappingOperation.abort(),(l=this.snappingManager)==null||l.doneSnapping();const{geometryType:n,numCommittedVertices:o}=this,c=n==="multipoint"&&o===0||n==="polyline"&&o<2||n==="polygon"&&o<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!c,(this.isCompleted||e)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map(((u,a)=>({componentIndex:0,vertexIndex:a,coordinates:u}))),aborted:e,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){var u,a;const e=It(this.cursorVertex),n=It(t),o=n&&(((u=this._updateAndGetEffectiveDrawSurface())==null?void 0:u.constrainZ(n))??n),c=this._snapToClosingVertex(o),l=this._applyConstraints(c);gt(e,l)||(this._set("cursorVertex",l),(a=this.segmentLabels)==null||a.set("stagedVertex",l!=null?this.coordinateHelper.pointToVector(l):null),l==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(l)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const e=this._mapToScreen(t);if(!e)return t;const n=this._activeComponent;return this._vertexWithinPointerDistance(n.vertices[0].pos,e)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,e)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return mt(t,((e,n,o,c)=>{const l=c==="touch"&&this._snappingEnabled;if(this.isCompleted||!l)return;const{snappingStep:u,cancelSnapping:a}=Di({predicate:()=>l,snappingManager:this.snappingManager,snappingContext:new Ft({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:c,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next((p=>(l&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),p))).next(a),n.next(this._screenToMapDragEventStep()).next((p=>(p.action==="start"&&(this._processCursor(p.mapStart),(this.geometryType==="segment"||l&&!this.numCommittedVertices)&&this.commitStagedVertex()),p))).next(Vi(this.view,this.elevationInfo)).next(...u).next((p=>(l&&(this._processCursor(p.mapEnd),p.action==="end"&&this.commitStagedVertex()),p))).next((p=>(p.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),p)))}))}_createManipulatorDragPipelineFreehand(t){return mt(t,((e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next((o=>(o.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o))).next((o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o}))}))}_createManipulatorDragPipelineHybrid(t){return mt(t,((e,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next((o=>(o.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Yt),this._processCursor(o.mapStart),this.commitStagedVertex()),o))).next((o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(Yt),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o}))}))}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:e,geometryType:n,numCommittedVertices:o}=this;return t?e!=null||n==="segment"&&o>0:(n==="segment"||n==="polygon")&&o>0}_updateAndGetEffectiveDrawSurface(){var p;const{constraintsEnabled:t,coordinateHelper:e,drawSurface:n,elevationDrawSurface:o,snapToSceneEnabled:c}=this;if(o==null)return n;if(!this.hasZ)return o.defaultZ=null,o;const l=(p=this.elevationInfo)==null?void 0:p.mode;let u=this.defaultZ,a=t||l==="absolute-height";return c!=null&&(a=c),l==="on-the-ground"&&(a=!1),this._drawAtFixedElevation&&(u=(t?this.constraintZ:null)??e.getZ(this._activeComponent.vertices[0].pos),a=!1),a?n:(o.defaultZ=u,o)}_mapToScreen(t){var e;return(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:e,geometryType:n}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const o=this._screenToMap(t.screenPoint);if(o==null||o==null||e==="freehand"&&n!=="point"&&n!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(o),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(e==="freehand"&&this.geometryType!=="multipoint"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&e==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const e=le(t.x,t.y);this._stagedScreenPoint=e,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(e,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,e){var a;const n=this._snappingOperation,o=this._screenToMap(t),c=this._requiresScenePoint?(a=this.drawSurface)==null?void 0:a.screenToMap(t):null;if(o==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const l=this.snappingManager;if(l==null)return this._processCursor(o),void n.abort();const u=this._getSnappingContext(e);this._updatingHandles.addPromise(Mt(n.snap({point:o,scenePoint:c},l,u)))}_applyConstraints(t){const{_constraint:e,constraints:n}=this;if(!t||!n||!e)return t;const{context:o}=n,c=ut(t,o),l=c?e.closestTo(c):void 0;if(!l)return t;const u=nn(l,t,o),a=this.view.type==="2d"||o.elevationInfo.mode!=="absolute-height";return u!=null&&a&&this.constraintZ!=null&&this.hasZ&&(u.z=this.constraintZ),u}_screenToMap(t){var e;return t?(e=this._updateAndGetEffectiveDrawSurface())==null?void 0:e.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return e=>{if(e.action==="start"&&(t=this._screenToMap(e.screenStart)),t==null)return null;const n=this._screenToMap(e.screenEnd);return n!=null?{...e,mapStart:t,mapEnd:n}:null}}_vertexWithinPointerDistance(t,e){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&Tn(o,e,25)}_getSnappingContext(t){var n;const e=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new Ft({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:e!=null?{value:e,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function Tn(i,t,e){const n=i.x-t.x,o=i.y-t.y;return n*n+o*o<=e}s([r()],h.prototype,"_hideDefaultCursor",void 0),s([r()],h.prototype,"_stagedPointerId",void 0),s([r()],h.prototype,"_isDragging",null),s([r()],h.prototype,"_snappingOperation",void 0),s([r()],h.prototype,"_snappingEnabled",null),s([r({constructOnly:!0})],h.prototype,"graphic",void 0),s([r()],h.prototype,"constraintsEnabled",void 0),s([r()],h.prototype,"constraints",void 0),s([r()],h.prototype,"_constraint",null),s([r()],h.prototype,"constraintZ",void 0),s([r()],h.prototype,"defaultZ",void 0),s([r()],h.prototype,"isDraped",void 0),s([r({constructOnly:!0})],h.prototype,"automaticLengthMeasurementUtils",void 0),s([r({value:Oe})],h.prototype,"drawingMode",null),s([r({constructOnly:!0})],h.prototype,"elevationDrawSurface",void 0),s([r({constructOnly:!0})],h.prototype,"elevationInfo",void 0),s([r({constructOnly:!0,type:ae})],h.prototype,"labelOptions",void 0),s([r({constructOnly:!0})],h.prototype,"geometryType",void 0),s([r({constructOnly:!0})],h.prototype,"hasM",void 0),s([r({constructOnly:!0})],h.prototype,"hasZ",void 0),s([r()],h.prototype,"cursor",void 0),s([r()],h.prototype,"effectiveCursor",null),s([r()],h.prototype,"loading",void 0),s([r({constructOnly:!0})],h.prototype,"manipulators",void 0),s([r({constructOnly:!0})],h.prototype,"drawSurface",void 0),s([r({constructOnly:!0})],h.prototype,"segmentLabels",void 0),s([r({constructOnly:!0})],h.prototype,"snappingManager",void 0),s([r({constructOnly:!0})],h.prototype,"snappingVisualizer",void 0),s([r()],h.prototype,"snapToSceneEnabled",void 0),s([r({readOnly:!0})],h.prototype,"cursorVertex",null),s([r({readOnly:!0})],h.prototype,"visualizationCursorVertex",null),s([r()],h.prototype,"committableVertex",null),s([r()],h.prototype,"firstVertex",void 0),s([r()],h.prototype,"lastVertex",void 0),s([r()],h.prototype,"secondToLastVertex",void 0),s([r()],h.prototype,"updating",null),s([r({constructOnly:!0})],h.prototype,"view",void 0),h=s([b("esri.views.draw.DrawOperation")],h);class eo{constructor(t,e,n,o=null){this._elevationInfo=t,this.defaultZ=e,this._view=n,this._excludeGraphics=o}screenToMap(t){const{defaultZ:e,_view:n}=this,o=n.sceneIntersectionHelper.intersectElevationFromScreen(oi(t.x,t.y),this._elevationInfo,e??0,this._excludeGraphics);return e==null&&o!=null&&(o.z=void 0),o}mapToScreen(t){const e=xt(t.x,t.y,pe(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(e)}constrainZ(t){const{defaultZ:e}=this;return e!=null&&t.z!==e&&((t=ce(t)).z=e),t}}class io{constructor(t,e,n=[]){this.view=t,this.elevationInfo=e,this.exclude=n}screenToMap(t){const e=this.view.toMap(t,{exclude:this.exclude,excludeLabels:!0});return e!=null&&(e.z=si(e,this.view,this.elevationInfo)),e}mapToScreen(t){let e=t;return this.elevationInfo!=null&&(e=xt(t.x,t.y,pe(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(e)}constrainZ(t){return t}}let no=class{constructor(t,e=!1,n=0){this.view=t,this.hasZ=e,this.defaultZ=n,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=e?o=>{const c=t.toMap(o);return c.z=n,c}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:e}=this;return this.hasZ&&t.z!==e&&((t=ce(t)).z=e),t}};const rt=class rt{screenToMap(t){const{x:e,y:n}=t;return new se({x:e,y:n,spatialReference:rt.spatialReference})}mapToScreen(t){return le(t.x,t.y)}constrainZ(t){return t}};rt.spatialReference=new Xt;let Kt=rt;function so(i,t){return $e(i,t,!1)}function ro(i,t){return $e(i,t,!0)}function $e(i,t,e){if(i instanceof Ei){if(i.operation instanceof Ri)return kn(i.operation,t,e),!0;if(i.operation instanceof Ui)return Vn(i.operation,t,e),!0;if(i.operation instanceof Ai)return Sn(i.operation,t,e),!0}return!1}function kn(i,t,e=!1){const n=e?-1:1,o=ui(n*i.dx,n*i.dy,n*i.dz);st(t.origin,t.origin,o),ct(t)}function Vn(i,t,e=!1){const n=e?-i.angle:i.angle;Ut(t.basis1,t.basis1,At,n),Ut(t.basis2,t.basis2,At,n),ct(t)}function Sn(i,t,e=!1){const n=e?1/i.factor1:i.factor1,o=e?1/i.factor2:i.factor2;Dt(t.basis1,t.basis1,n),Dt(t.basis2,t.basis2,o),Gt(t.origin,t.origin,i.origin,i.axis1,n),Gt(t.origin,t.origin,i.origin,i.axis2,o),ct(t)}function ao(i,t,e,n,o=!1){n||(n=ri());const c=N(B.get(),i[1],-i[0]),l=N(B.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=N(B.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),a=B.get(),p=t.allVertices;p.forEach((({pos:f})=>{N(a,Et(i,f),Et(c,f)),ai(l,l,a),li(u,u,a)}));const d=1e-6,y=N(B.get(),u[0]-l[0]<d?e/2:0,u[1]-l[1]<d?e/2:0);ci(l,l,y),pi(u,u,y);const w=o?p.reduce(((f,g)=>f+(g.pos[2]??0)),0)/p.length:0;return Rt(n.basis1,i,(u[0]-l[0])/2),Rt(n.basis2,c,(u[1]-l[1])/2),Qt(n.origin,l[0]*i[0]+l[1]*c[0],l[0]*i[1]+l[1]*c[1],w),st(n.origin,n.origin,n.basis1),st(n.origin,n.origin,n.basis2),ct(n),n}export{m as E,h as F,ao as S,ro as T,Xn as a,eo as c,so as d,no as h,io as l};
