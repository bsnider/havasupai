import{el as E,c1 as v,ek as D,cJ as H,q5 as R,aP as b,qg as P,ap as h,dk as k,ec as L,e as T,kB as f,mk as O,ab as V,q6 as M,av as p,r as u,m as w,d as j,mp as q,u as m,q7 as y}from"./index-DtL3GvY-.js";import{e as I,a as S}from"./visualizationUtils-Bjtug6g3.js";import{j as C}from"./settings-D2Gkb6qw.js";import{j as $}from"./OutlineVisualElement-BSyCbTco.js";import{e as x}from"./GraphicState-CT_-Y4OQ.js";import"./AnchorElementViewModel-CrYQfA22.js";import"./createUtils-CYD0URqB.js";import"./distanceOperator-BjSleFAw.js";import"./Point2D-BUVSeX7E.js";import"./ProjectionTransformation-oWBTjYTq.js";import"./Envelope2D-zGBO_y2e.js";import"./Transformation2D-DNNU7gV_.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-BO6RTr6N.js";import"./jsonConverter-CCE0HW-0.js";import"./simplifyOperator-IHhWUA5n.js";import"./operatorSimplify-Dgmk00_g.js";import"./ExtendedLineVisualElement-Cc6r61Dg.js";import"./EngineVisualElement-C90vBsy7.js";import"./VisualElement-CJZRdrnY.js";import"./LaserlinePath.glsl-DZnPVcw0.js";import"./lineStippleUtils-C89mzWlO.js";import"./line-B8eVciUl.js";import"./line--0ClkaT5.js";import"./triangulationUtils-BuH1nIo8.js";import"./deduplicate-C7ufsMMT.js";let z=class{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new C({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=E(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!c(e))return;const i=e.layer;this._highlightTask=D((async t=>{const s=await this._params.view.whenLayerView(i);H(t),R(s)&&(this._highlightHandle=s.highlight(e))}))}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new $({view:i,geometry:c(e)?e.geometry:null,attached:!1,elevationInfo:P(e),renderOccluded:b.OccludeAndTransparentStencil,isDecoration:!0}),s=new x({graphic:e}),a=[h((()=>s.isDraped),(o=>{t.isDraped=o})),s.on("changed",(()=>{t.geometry=c(e)?e.geometry:null})),i.trackGraphicState(s),i.maskOccludee(e),k(t)];this._settings.visualElements.lineObjects.outline.apply(t),t.attached=!0,this._visualElementHandle=L(a)}};function c(r){return r.geometry!=null&&r.geometry.type==="polyline"}let d=class extends T{constructor(r){super(r),this._chartData=null,this._visualElements=[],this._update=e=>{const{chartData:i}=e;if(i==null)return this.remove();if(!i.refined)return;const t=this._visualElements,s=i.lines.filter((n=>n.viewVisualizationEnabled)),a=s.length;for(;t.length>a;)t.pop().destroy();const o=f().profileLinesStyle3D;for(;t.length<a;){const n=new $({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:o.innerWidth,innerColor:o.innerColor,width:o.width,falloff:o.falloff,renderOccluded:o.renderOccluded,isDecoration:!0});t.push(n)}const l=e.spatialReference;for(let n=0;n<a;++n){const g=t[n],_=s[a-1-n];g.geometry=I(_,l),g.color=O(V.toUnitRGBA(_.color))}}}initialize(){const r=f().profileLinesUpdateThrottleMillis;let e=this._update;{const i=M(this._update,r);this.addHandles(i),e=i}this.addHandles([h((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e,p)])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(r){this._chartData=r}_destroyVisualElements(){this._visualElements.forEach((r=>r.destroy())),this._visualElements.length=0}};u([w()],d.prototype,"view",void 0),u([w()],d.prototype,"_chartData",void 0),d=u([j("esri.widgets.ElevationProfile.support.ProfileLines3D")],d);class ge{constructor(e,i){this._handles=new q,this._inputRepresentation=new z({view:e}),this._hoveredPoints=new S({view:e}),this._profileLines=new d({view:e}),this._handles.add([h((()=>i.viewModel.hoveredPoints),(t=>this._hoveredPoints.update(t)),p),h((()=>{const{state:t,editable:s,highlightEnabled:a,viewModel:o}=i,l=o.input;return l&&(l.commitProperty("geometry"),l.commitProperty("layer")),{input:l,state:t,editable:s,highlightEnabled:a}}),(t=>this._updateInputRepresentation(t)),p),h((()=>i.viewModel.chartData),(t=>this._profileLines.update(t)),p),h((()=>{var t;return(t=i.viewModel.input)==null?void 0:t.geometry}),(()=>{this._profileLines.remove()}),p)])}destroy(){this._handles=m(this._handles),this._inputRepresentation=m(this._inputRepresentation),this._hoveredPoints=m(this._hoveredPoints),this._profileLines=m(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:s}){const a=this._inputRepresentation;if(!s)return a.remove();i===y.Selected?a.showHighlight(e):i!==y.Created||t?a.remove():a.showReshaping(e)}}export{ge as ElevationProfileView3D};
