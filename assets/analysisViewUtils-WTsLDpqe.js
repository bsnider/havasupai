import{dy as $,at as _,r as a,m as r,d as w,ap as f,av as m,ek as b,cJ as y,ec as g,dz as C,ao as V,c2 as T,dm as I,c1 as M}from"./index-DXVHLZmj.js";import{n as A}from"./InteractiveToolBase-BN_OWso1.js";const k=e=>{let t=class extends $.EsriPromiseMixin(e){constructor(){super(...arguments),this.parent=null,this._userInteractive=!1,this._interactiveViewModelCount=0}get interactive(){return this._interactiveViewModelCount>0||this._userInteractive}set interactive(i){this._userInteractive=i}get updating(){return!1}get visible(){return this.parent==null||this.parent.visible&&!this.parent.suspended}set visible(i){this._overrideIfSome("visible",i)}forceInteractive(){return this._interactiveViewModelCount++,_((()=>this._interactiveViewModelCount--))}};return a([r({constructOnly:!0})],t.prototype,"parent",void 0),a([r({constructOnly:!0})],t.prototype,"view",void 0),a([r({type:Boolean})],t.prototype,"interactive",null),a([r()],t.prototype,"_userInteractive",void 0),a([r({readOnly:!0})],t.prototype,"updating",null),a([r()],t.prototype,"visible",null),a([r()],t.prototype,"_interactiveViewModelCount",void 0),t=a([w("esri.views.3d.analysis.AnalysisView3D")],t),t};let h=class extends A{constructor(e){super(e)}initialize(){this.addHandles(f((()=>this.analysisViewData.visible),(e=>this.visible=e),m))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};h=a([w("esri.views.interactive.AnalysisToolBase")],h);function x(e,t){e.interactive=!0;const{tool:i,view:s}=e;s.activeTool=i;let n=T(t,(()=>{s.activeTool===i&&(s.activeTool=null)}));return b((async o=>{await I((()=>{var l;return!((l=e.tool)!=null&&l.active)}),o),n=M(n)}),t)}function q(e,t){return f((()=>e.interactive),(()=>D(e,t)),m)}function D(e,t){e.interactive?j(e,t):O(e)}function j(e,t){O(e);const{view:i,analysis:s}=e,n=new t({view:i,analysis:s,analysisViewData:e});return e.tool=n,i.tools.add(n),n}function O(e){const{view:t,tool:i}=e;i!=null&&(t.tools.remove(i),e.tool=null)}function z(e,t){var n;const i=e.userOperation,s=b((async o=>{var d;if(i){const c=i.promise.catch((()=>{}));i==null||i.abort(),await c,y(o)}const l=x(e,{signal:o}),p=(t==null?void 0:t.shouldRejectOnCancel)??(()=>!0),u=g([C((()=>e.tool),"cancel",(()=>{p()&&l.abort()}))]),{tool:v}=e;try{v&&(v.resetCreated(),(d=t==null?void 0:t.onToolActivated)==null||d.call(t,v)),await l.promise,y(o)}catch(c){if(o.aborted||!V(c)||p())throw c}finally{u==null||u.remove()}}),{signal:(n=t==null?void 0:t.abortOptions)==null?void 0:n.signal});return e.userOperation=s,s.promise.finally((()=>{e.userOperation===s&&(e.userOperation=null)}))}async function E(e,t){const i=e.analysis.clone();return await z(e,{abortOptions:t==null?void 0:t.placementOptions,onToolActivated:t==null?void 0:t.onToolActivated,shouldRejectOnCancel:()=>{const{analysis:s}=e;return!s.valid||s.equals(i)}}),{}}export{E as d,O as f,q as m,h as o,k as s,z as y};
