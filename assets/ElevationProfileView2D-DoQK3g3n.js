import{el as _,c1 as m,ek as g,cJ as y,q5 as v,e as f,aa as w,jr as $,ij as P,f$ as D,q6 as M,kB as R,ap as h,av as n,r as p,m as c,d as b,mp as E,u as l,q7 as L}from"./index-CxDa6KP7.js";import{e as S,a as k}from"./visualizationUtils-DLp1u7Zd.js";import"./AnchorElementViewModel-DiKIhBpF.js";import"./createUtils-BwLf1k3p.js";import"./distanceOperator-CbrXDOC1.js";import"./Point2D-BUVSeX7E.js";import"./ProjectionTransformation-DE_mUYa_.js";import"./Envelope2D-zGBO_y2e.js";import"./Transformation2D-DNNU7gV_.js";import"./SimpleGeometryCursor-B92kdZ15.js";import"./OperatorDefinitions-DP7_WWTp.js";import"./apiConverter-3p3bEB5P.js";import"./jsonConverter-DUGTIL16.js";import"./simplifyOperator-Dblt5VQr.js";import"./operatorSimplify-BAcIpU-t.js";class H{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null}destroy(){this.remove()}remove(){this._highlightTask=_(this._highlightTask),this._highlightHandle=m(this._highlightHandle)}update(e){if(this.remove(),e==null||!I(e))return;const i=e.layer;this._highlightTask=g((async t=>{const a=await this._params.view.whenLayerView(i);y(t);const r=v(a)?a:null;r&&(this._highlightHandle=r.highlight(e))}))}}function I(s){return s.geometry!=null&&s.geometry.type==="polyline"}let o=class extends f{constructor(s){super(s),this._chartData=null,this._graphic=new w,this._layer=new $({listMode:"hide",internal:!0,title:"Profile line"}),this._update=e=>{var r,d;const{chartData:i}=e;if(i==null)return this.remove();if(!i.refined)return;const t=i.lines.find((u=>u.viewVisualizationEnabled));if(!t)return;this._graphic.geometry=S(t,e.spatialReference),this._graphic.symbol=new P({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[5,10],lineDashEnding:"HalfPattern",controlPointEnding:"HalfPattern"}],capStyle:"Butt",width:1.5,color:t.color.toArray()},{type:"CIMSolidStroke",capStyle:"Butt",width:2,color:D(t.color).toArray()}]}}});const a=(d=(r=this.view)==null?void 0:r.map)==null?void 0:d.layers;a&&!a.includes(this._layer)&&a.add(this._layer)}}initialize(){this._layer.add(this._graphic);const s=R().profileLinesUpdateThrottleMillis;let e=this._update;{const i=M(this._update,s);this.addHandles(i),e=i}this.addHandles(h((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e,n))}destroy(){this.remove()}remove(){var s,e;(e=(s=this.view)==null?void 0:s.map)==null||e.remove(this._layer)}update(s){this._chartData=s}};p([c()],o.prototype,"view",void 0),p([c()],o.prototype,"_chartData",void 0),o=p([b("esri.widgets.ElevationProfile.support.ProfileLine2D")],o);class O{constructor(e,i){this._handles=new E,this._inputRepresentation=new H({view:e}),this._hoveredPoints=new k({view:e}),this._profileLine=new o({view:e}),this._handles.add([h((()=>i.viewModel.hoveredPoints),(t=>this._hoveredPoints.update(t)),n),h((()=>{const{state:t,highlightEnabled:a,viewModel:r}=i;return{input:r.input,state:t,highlightEnabled:a}}),(t=>this._updateInputRepresentation(t)),n),h((()=>i.viewModel.chartData),(t=>this._profileLine.update(t)),n),h((()=>{var t;return(t=i.viewModel.input)==null?void 0:t.geometry}),(()=>{this._profileLine.remove()}),n)])}destroy(){this._handles=l(this._handles),this._inputRepresentation=l(this._inputRepresentation),this._hoveredPoints=l(this._hoveredPoints),this._profileLine=l(this._profileLine)}_updateInputRepresentation({input:e,state:i,highlightEnabled:t}){i===L.Selected&&t?this._inputRepresentation.update(e):this._inputRepresentation.remove()}}export{O as ElevationProfileView2D};
