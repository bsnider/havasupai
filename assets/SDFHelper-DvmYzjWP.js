import{bD as V,bE as k,bF as L,bG as X}from"./index-Ds3x37R4.js";import{t as Y}from"./CIMSymbolHelper-Mc-3ZV3A.js";const j=.45;function q(n,t=.5){var i;switch(n.type){case"CIMPointSymbol":{const o=n.symbolLayers;if(!o||o.length!==1)return null;const a=o[0];return a.type!=="CIMVectorMarker"?null:q(a)}case"CIMVectorMarker":{const o=n.markerGraphics;if(!o||o.length!==1)return null;const a=o[0];if(!a)return null;const e=a.geometry;if(!e)return null;const r=a.symbol;return!r||r.type!=="CIMPolygonSymbol"&&r.type!=="CIMLineSymbol"||(i=r.symbolLayers)!=null&&i.some((l=>!!l.effects))?null:{type:"sdf",geom:e,sdfPaddingRatio:t,asFill:r.type==="CIMPolygonSymbol"}}}}function E(n){return n?n.rings?n.rings:n.paths?n.paths:n.xmin!==void 0&&n.ymin!==void 0&&n.xmax!==void 0&&n.ymax!==void 0?[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]:null:null}function U(n){let t=1/0,i=-1/0,o=1/0,a=-1/0;for(const e of n)for(const r of e)r[0]<t&&(t=r[0]),r[0]>i&&(i=r[0]),r[1]<o&&(o=r[1]),r[1]>a&&(a=r[1]);return new Y(t,o,i-t,a-o)}function G(n){let t=1/0,i=-1/0,o=1/0,a=-1/0;for(const e of n)for(const r of e)r[0]<t&&(t=r[0]),r[0]>i&&(i=r[0]),r[1]<o&&(o=r[1]),r[1]>a&&(a=r[1]);return[t,o,i,a]}function B(n){return n?n.rings?G(n.rings):n.paths?G(n.paths):V(n)?[n.xmin,n.ymin,n.xmax,n.ymax]:null:null}function Q(n,t){const[i,o,a,e]=B(n),r=a-i,l=e-o,m=k,c=L,s=Math.floor(.5*(m*t-c)),f=(m-2*(s+c))/Math.max(r,l),d=Math.round(r*f),h=Math.round(l*f);return{pixelDimensions:[r,l],texelDimensions:[Math.round((d+2*s)/f),Math.round((h+2*s)/f)]}}function T(n,t,i,o,a,e,r){const[l,m,c,s]=n;if(c<l||s<m)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const f=c-l,d=s-m,h=Math.max(f,d);let u=.5;if(e!=null&&i!=null){!r&&t!=null&&(e*=(t.ymax-t.ymin)/i);const C=e/(e+h);C>j&&C<1&&(u=Math.min(C+.1,.99))}const x=k,M=L,p=Math.floor(.5*(x*u-M)),g=(x-2*(p+M))/h,I=Math.round(f*g)+2*p,R=Math.round(d*g)+2*p;let y=1;t&&(y=R*(1-u)/((t.ymax-t.ymin)*g));let w=0,b=0,P=1;o&&(a?t&&i&&t.ymax-t.ymin>0&&(P=(t.xmax-t.xmin)/(t.ymax-t.ymin),w=o.x/(i*P),b=o.y/i):(w=o.x,b=o.y)),t&&(w=.5*(t.xmax+t.xmin)+w*(t.xmax-t.xmin),b=.5*(t.ymax+t.ymin)+b*(t.ymax-t.ymin)),w-=l,b-=m,w*=g,b*=g,w+=p,b+=p;let S=w/I-.5,F=b/R-.5;return a&&i&&(S*=i*P,F*=i),{frameSizeRatio:y,anchorX:S,anchorY:F,widthRatio:P,sdfPaddingRatio:u}}function W(n){const t=E(n.geom),i=U(t),o=k,a=L,e=Math.floor(.5*(o*n.sdfPaddingRatio-a)),r=o-2*(e+a),l=r/Math.max(i.width,i.height),m=Math.round(i.width*l)+2*e,c=Math.round(i.height*l)+2*e,s=[];for(const d of t)if(d&&d.length>1){const h=[];for(const u of d){let[x,M]=u;x-=i.x,M-=i.y,x*=l,M*=l,x+=e-.5,M+=e-.5,n.asFill?h.push([x,M]):h.push([Math.round(x),Math.round(M)])}if(n.asFill){const u=h.length-1;h[0][0]===h[u][0]&&h[0][1]===h[u][1]||h.push(h[0])}s.push(h)}const f=H(s,m,c,e);return n.asFill&&J(s,m,c,e,f),{data:K(f,e),width:m,height:c,sdfPaddingRatio:n.sdfPaddingRatio,sdfDecodeCoeff:2*e/r}}function H(n,t,i,o){const a=t*i,e=new Array(a),r=o*o+1;for(let l=0;l<a;++l)e[l]=r;for(const l of n){const m=l.length;for(let c=1;c<m;++c){const s=l[c-1],f=l[c];let d,h,u,x;s[0]<f[0]?(d=s[0],h=f[0]):(d=f[0],h=s[0]),s[1]<f[1]?(u=s[1],x=f[1]):(u=f[1],x=s[1]);let M=Math.floor(d)-o,p=Math.floor(h)+o,g=Math.floor(u)-o,I=Math.floor(x)+o;M<0&&(M=0),p>t&&(p=t),g<0&&(g=0),I>i&&(I=i);const R=f[0]-s[0],y=f[1]-s[1],w=R*R+y*y;for(let b=M;b<p;b++)for(let P=g;P<I;P++){const S=b+.5,F=P+.5;let C,v,D=(S-s[0])*R+(F-s[1])*y;D<0?(C=s[0],v=s[1]):D>w?(C=f[0],v=f[1]):(D/=w,C=s[0]+D*R,v=s[1]+D*y);const z=(S-C)*(S-C)+(F-v)*(F-v),A=(i-P-1)*t+b;z<e[A]&&(e[A]=z)}}}for(let l=0;l<a;++l)e[l]=Math.sqrt(e[l]);return e}function J(n,t,i,o,a){for(const e of n){const r=e.length;for(let l=1;l<r;++l){const m=e[l-1],c=e[l];let s,f,d,h;m[0]<c[0]?(s=m[0],f=c[0]):(s=c[0],f=m[0]),m[1]<c[1]?(d=m[1],h=c[1]):(d=c[1],h=m[1]);let u=Math.floor(s),x=Math.floor(f)+1,M=Math.floor(d),p=Math.floor(h)+1;u<o&&(u=o),x>t-o&&(x=t-o),M<o&&(M=o),p>i-o&&(p=i-o);for(let g=M;g<p;++g){if(m[1]>g==c[1]>g)continue;const I=g+.5,R=(i-g-1)*t;for(let y=u;y<x;++y)y+.5<(c[0]-m[0])*(I-m[1])/(c[1]-m[1])+m[0]&&(a[R+y]=-a[R+y]);for(let y=o;y<u;++y)a[R+y]=-a[R+y]}}}}function K(n,t){const i=2*t,o=n.length,a=new Uint8Array(4*o);for(let e=0;e<o;++e){const r=.5-n[e]/i;X(r,a,4*e)}return a}export{q as a,Q as c,T as h,B as m,W as u};
