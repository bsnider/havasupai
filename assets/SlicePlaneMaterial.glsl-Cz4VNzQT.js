import{aO as D,x2 as ye,vj as Ye,EK as ze,aZ as J,ER as $e,FT as Oe,ET as Je,EJ as Ke,EV as Qe,EW as et,_ as tt,EY as st,F1 as rt,pt as at,F6 as it,pC as nt,F8 as ot,GG as ct,Fi as lt,aP as T,Fg as dt,aR as we,oK as ut,x3 as se,fp as M,aT as K,fO as u,aV as m,aW as h,wA as fe,ta as k,mS as We,mV as F,fq as P,fo as Ge,t2 as je,pH as De,aL as gt,FR as ft,ir as ht,kN as Ce,tO as Fe,GH as oe,t6 as pt,d_ as Ie,B4 as mt,bW as bt,GI as _t,ff as Tt,fm as w,fs as V,t8 as $t,B$ as Ot,eJ as S,GJ as ce,GK as wt,GL as Ct,h3 as It,wC as ke,eI as E,xW as Et,aX as j,ap as he,c as pe,ab as A,dJ as R,fy as U,wz as _,g0 as Ee,f$ as le,cH as At,b8 as vt,ba as Ae,ml as X,aU as Q,xZ as ve,rG as Re,h6 as ie,jF as Pe,qc as Me,GM as Se,wE as Le,BZ as Rt}from"./index-BdmtnMtL.js";import{g as Pt,j as Mt,u as xe,v as St,C as z,e as Lt,i as Ue,b as xt,d as He,s as Ut,k as Ht,q as Nt,n as Be,x as de,U as Vt,S as yt,l as Wt,a as Gt,c as jt}from"./sliceToolConfig-CpDfT92o.js";import{c as Dt,O as Ft,d as kt,r as Bt,e as me,b as qt,a as b,j as qe}from"./ShadedColorMaterial.glsl-CovW3wZa.js";import{_ as Xt}from"./ImageMaterial.glsl-C5_h2ia2.js";import{c as Zt}from"./SlicePlane-BvNb6Yq7.js";import{c as Yt}from"./DefaultLayouts-D-NaZYig.js";import{r as zt}from"./TriangleMaterial-B5LadwCK.js";import{A as Z}from"./ColorMaterial.glsl-q-IxfOuP.js";const Jt=D(0,0,0,.04);function Kt({accentColor:e}){return ye(e,.5)}function Qt({accentColor:e}){return ye(e,.7)}function Xe(e){const t=new Ye,{vertex:n,fragment:a,attributes:r,varyings:i}=t;return ze(n,e),r.add(J.POSITION,"vec3"),r.add(J.UV0,"vec2"),i.add("vUV","vec2"),n.main.add($e`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),a.uniforms.add(new Oe("backgroundColor",(s=>s.backgroundColor)),new Oe("gridColor",(s=>s.gridColor)),new Je("gridWidth",(s=>s.gridWidth))).main.add($e`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const es=Object.freeze(Object.defineProperty({__proto__:null,build:Xe},Symbol.toStringTag,{value:"Module"}));class ts extends Ke{constructor(){super(...arguments),this.backgroundColor=D(1,0,0,.5),this.gridColor=D(0,1,0,.5),this.gridWidth=4}}let ss=class extends Qe{constructor(t,n){super(t,n,new et(es,(()=>tt(()=>Promise.resolve().then(()=>bs),void 0))))}initializePipeline(){return st({blending:it,depthTest:{func:at.LESS},colorWrite:rt})}};class rs extends zt{constructor(t){super(t,is),this.produces=new Map([[nt.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,n=>ot(n)]]),this._configuration=new ct}get visible(){return!0}createGLMaterial(t){return new as(t)}createBufferWriter(){return new lt(Yt)}getConfiguration(){return this._configuration}}class as extends dt{constructor(t){super(t)}beginSlot(t){return this.getTechnique(ss,t)}}class is extends ts{constructor(){super(...arguments),this.renderOccluded=T.Occlude,this.isDecoration=!1}}class ns extends Dt{constructor(t){super(t),this._material=null,this._renderOccluded=T.OccludeAndTransparent,this._gridWidth=1,this._gridColor=D(1,0,0,1),this._backgroundColor=D(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){we(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){we(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new rs(this._materialParameters)}destroyExternalResources(){this._material=null}forEachMaterial(t){t(this._material)}createGeometries(t){if(this._material!=null){const n=ut(this._material);t.addGeometry(n)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){var t;(t=this._material)==null||t.setParameters(this._materialParameters)}}function vs(e,t,n,a,r,i,s,o){return os(t,s.worldUpAtPosition(e,u.get()),r,i,o.basis1,o.basis2),h(o.basis1,o.basis1,n),h(o.basis2,o.basis2,a),P(o.origin,e),Fe(o.basis2,o.basis1,o.origin,o.plane),o}function os(e,t,n,a,r,i){const s=V(e,t),o=u.get(),c=u.get();switch(a===v.HORIZONTAL_OR_VERTICAL?Math.abs(s)>Lt?v.HORIZONTAL:v.VERTICAL:a){case v.VERTICAL:{const d=Math.abs(s)<=Ue?e:n.viewUp;E(o,d,t),P(c,t);break}case v.HORIZONTAL:E(o,n.viewUp,t),E(c,t,o);break;case v.TILTED:{const d=Math.abs(s)<=Ue?t:n.viewUp;E(o,d,e),E(c,e,o);break}}const l=E(u.get(),o,c);V(l,n.viewForward)>0&&h(c,c,-1),S(r,o),S(i,c)}function cs(e,t,n){const a=t.worldUpAtPosition(e.origin,u.get()),r=e.basis1,i=Te(e,a),s=Math.round(i/y)*y;return oe(e,s-i,r,n)}function Rs(e,t,n,a,r,i){const s=P(u.get(),r.origin);m(s,s,h(u.get(),r.basis1,e.direction[0]<0?1:-1)),m(s,s,h(u.get(),r.basis2,e.direction[1]<0?1:-1));const o=M(r.basis1),c=M(r.basis2),l=w(u.get(),n,s),d=w(u.get(),t,s);let g=0,f=0;if(_e(e)){const re=ue(r),W=ue(i);g=o-.5*e.direction[0]*V(r.basis1,d)/o,f=c-.5*e.direction[1]*V(r.basis2,d)/c;const B=W/re;g*=B,f*=B}const p=g+.5*e.direction[0]*V(r.basis1,l)/o,O=f+.5*e.direction[1]*V(r.basis2,l)/c,H=h(u.get(),r.basis1,p/o),L=h(u.get(),r.basis2,O/c);(p<=0||Ne(i.origin,H,a)<=xe)&&P(H,i.basis1),(O<=0||Ne(i.origin,L,a)<=xe)&&P(L,i.basis2);const $=P(u.get(),s);return m($,$,h(u.get(),H,e.direction[0]<0?-1:1)),m($,$,h(u.get(),L,e.direction[1]<0?-1:1)),$t($,H,L,i)}function Ps(e,t){return St*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Ms(e,t,n,a){const r=E(u.get(),t,n);return E(r,r,t),Ge(e,r,a)}function Ss(e,t){return Ft(e.basis1,e.basis2,e.origin,t)}function Ls(e,t,n,a){const r=t.worldUpAtPosition(e.origin,u.get()),i=u.get();switch(n){case ee.HEADING:P(i,r);break;case ee.TILT:P(i,e.basis1)}return Ge(e.origin,i,a)}function xs(e,t,n,a){const r=be(n,C.NEGATIVE_X),i=k.get();Ot(i,t,r.edge*Math.PI/2);const s=S(u.get(),r.basis);let o=h(u.get(),s,r.direction*a.computeScreenPixelSizeAt(r.position)*z);m(o,o,r.position);const c=a.projectToRenderScreen(o,ce(u.get())),l=ls(a,c);wt(a,c,Y),S(Y.direction,Y.direction);const d=u.get();!l&&Ct(n,Y,d)&&(o=d),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=It(o),l?e.state|=te:e.state&=~te}function ls(e,t){const[n,a,r,i]=e.viewport,s=Math.min(r,i)/16;let o=!0;return t[0]<n+s?(t[0]=n+s,o=!1):t[0]>n+r-s&&(t[0]=n+r-s,o=!1),t[1]<a+s?(t[1]=a+s,o=!1):t[1]>a+i-s&&(t[1]=a+i-s,o=!1),o}function Us(e,t,n,a){const r=M(a.basis1),i=M(a.basis2),s=Ze(a),o=ue(a),c=K(u.get(),0,0,0);m(c,h(u.get(),a.basis1,t.direction[0]),h(u.get(),a.basis2,t.direction[1])),m(c,a.origin,c);let l=0,d=1;if(_e(t))t.direction[0]===1&&t.direction[1]===-1?l=y:t.direction[0]===1&&t.direction[1]===1?l=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(l=3*Math.PI/2),d=o;else{const f=t.direction[0]!==0?1:2;l=f===1?y:0,d=(f===1?i:r)-s}const g=fe(k.get(),l);We(g,g,K(u.get(),d,d,d)),F(g,n,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=c}function Hs(e,t,n,a){const r=a.worldUpAtPosition(n.origin,u.get()),i=be(n,C.POSITIVE_X),s=fe(k.get(),i.edge*Math.PI/2);ke(s,s,-Te(n,r)),F(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=i.position}function Ns(e,t,n){const a=be(n,C.POSITIVE_Y),r=fe(k.get(),a.edge*Math.PI/2);ke(r,r,y),F(r,t,r),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=a.position}var C;function be(e,t){switch(t){case C.POSITIVE_X:return{basis:e.basis1,direction:1,position:m(u.get(),e.origin,e.basis1),edge:t};case C.POSITIVE_Y:return{basis:e.basis2,direction:1,position:m(u.get(),e.origin,e.basis2),edge:t};case C.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(u.get(),e.origin,e.basis1),edge:t};case C.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(u.get(),e.origin,e.basis2),edge:t}}}function Ne(e,t,n){const a=n.projectToRenderScreen(m(u.get(),e,t),ce(u.get())),r=n.projectToRenderScreen(w(u.get(),e,t),ce(u.get()));return Et(w(a,a,r))}function Ze(e){const t=M(e.basis1),n=M(e.basis2);return Pt*Math.min(t,n)}function ue(e){return Ze(e)}function _e(e){return e.direction[0]!==0&&e.direction[1]!==0}function Vs(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new kt({view:e,attached:!1,color:Qt(e.effectiveTheme),width:Mt,renderOccluded:T.OccludeAndTransparent,geometry:[t],isDecoration:!0})}function ys(e){return new ns({view:e,attached:!1,backgroundColor:Jt,gridColor:Kt(e.effectiveTheme),gridWidth:4,renderOccluded:T.OccludeAndTransparent,isDecoration:!0})}function Ws(e,t,n,a=new Zt){if(e==null)return null;const{renderCoordsHelper:r}=t,i=r.fromRenderCoords(e.origin,new gt({spatialReference:t.spatialReference}));if(i==null)return null;const s=ft(i,n);if(s==null)return null;a.position=s;const o=2*M(e.basis1),c=2*M(e.basis2),l=De.renderUnitScaleFactor(t.spatialReference,n);a.width=o*l,a.height=c*l;const d=r.worldUpAtPosition(e.origin,u.get());return a.tilt=ht(Te(e,d)),a.heading=r.headingAtPosition(e.origin,e.basis1)-90,a}function Te(e,t){return _t(t,e.basis2,e.basis1)+y}function ds(e,t,n,a,r,i,s=je()){return i.toRenderCoords(e,s.origin)?(i.worldBasisAtPosition(s.origin,Ce.X,s.basis1),i.worldBasisAtPosition(s.origin,Ce.Y,s.basis2),Fe(s.basis2,s.basis1,s.origin,s.plane),oe(s,-Ie(t),pt(s),s),oe(s,Ie(n),s.basis1,s),h(s.basis1,s.basis1,a/2),h(s.basis2,s.basis2,r/2),mt(s),s):(bt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function Gs(e,t){if((e==null?void 0:e.position)==null)return null;const n=Bt(e.position,t.spatialReference,t.elevationProvider);if(n==null)return null;const a=De.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),r=e.width*a,i=e.height*a;return{position:n,heading:e.heading,tilt:e.tilt,renderWidth:r,renderHeight:i}}function js(e,t,n,a=je()){if(e==null)return null;const r=ds(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return n.tiltEnabled||r==null||cs(r,t.renderCoordsHelper,r),r}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(C||(C={}));const I=se.Custom1;var ee,v;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ee||(ee={})),(function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"})(v||(v={}));const te=se.Custom2,Y=Tt(),y=Math.PI/2,ne=se.Custom1,us=se.Custom2;function Ds(e){return(e.type==="building-scene-3d"?e:null)!=null}let Fs=class extends me{constructor(t,n){const a=_e(n),r=a?xt:He,i=r*Ut,s=He,o={renderOccluded:T.OccludeAndTransparent,isDecoration:!0},c=new j({...o,width:r}),l=new j({...o,width:i}),d=new j({...o,width:s});super({view:t,...qt,...gs({isCorner:a,unfocusedMaterial:c,focusedMaterial:l,outlineMaterial:d})}),this._themeHandle=he((()=>t.effectiveTheme.accentColor),(g=>{const f=A.toUnitRGBA(g);c.setParameters({color:f}),l.setParameters({color:f}),d.setParameters({color:f})}),pe)}destroy(){this._themeHandle.remove(),super.destroy()}};function gs({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:a}){const r=e?[R(1,0,0),R(0,0,0),R(0,1,0)]:[R(1,0,0),R(-1,0,0)];return{renderObjects:[new b(U(t,r),_.Unfocused|ne),new b(U(n,r),_.Focused|ne),new b(U(a,r),us)],collisionType:{type:"line",paths:[r]},radius:e?Ht:Nt,state:ne}}class Bs extends me{constructor(t,n){const a=Ee(t.effectiveTheme.accentColor,.5),r=le(t.effectiveTheme.accentColor),i=n(a,r),s=new Xt({draped:!1,texture:i.texture,writeDepth:!1,renderOccluded:T.Opaque,isDecoration:!0}),o=qe.calloutWidth,c=new j({width:o,renderOccluded:T.OccludeAndTransparent,isDecoration:!0});super({view:t,...fs({imageMaterial:s,calloutMaterial:c})}),this._material=s,this._textureHandle=i,this._themeHandle=he((()=>t.effectiveTheme.accentColor),(l=>{const d=Ee(l,.5),g=le(l),f=this._textureHandle;this._textureHandle=n(d,g),s.setParameters({texture:this._textureHandle.texture}),f==null||f.release(),c.setParameters({color:A.toUnitRGBA(l)})}),pe)}destroy(){this._textureHandle=At(this._textureHandle),this._themeHandle.remove(),this._material.dispose(),super.destroy()}}function fs({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:n,calloutLength:a,discRadius:r}=qe,i=r*n,s=(d,g)=>{const f=[0,1,2,2,3,0];return new vt(g,[[J.POSITION,new Ae([a-d,-d,0,a+d,-d,0,a+d,d,0,a-d,d,0],f,3,!0)],[J.UV0,new Ae([0,0,1,0,1,1,0,1],f,2,!0)]])},o=U(t,[[0,0,0],[a-r,0,0]]),c=U(t,[[0,0,0],[a-i,0,0]]),l=I;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[a,0,0]},focusMultiplier:n,radius:r,renderObjects:[new b(s(r,e),_.Unfocused|l),new b(o,_.Unfocused|l),new b(s(i,e),_.Focused|l),new b(c,_.Focused|l)],state:l}}var ge;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ge||(ge={}));class qs extends me{constructor(t,n){const a=new j({width:1,renderOccluded:T.OccludeAndTransparent,isDecoration:!0}),r=new Z({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),i=new Z({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),s=new Z({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),o=new Z({writeDepth:!1,cullFace:X.Front,renderOccluded:T.Transparent,isDecoration:!0});super({view:t,...hs({offsetMode:n,tubeMaterial:r,tipMaterial:i,capMaterial:s,outlineMaterial:o,calloutMaterial:a})}),this._themeHandle=he((()=>t.effectiveTheme.accentColor),(c=>{const l=le(c),d=A.toUnitRGBA(c),g=A.toUnitRGBA(l),f=A.toUnitRGBA(A.blendColors(l,c,.4)),p=A.toUnitRGBA(A.blendColors(l,c,.14));a.setParameters({color:d}),r.setParameters({color:p}),i.setParameters({color:g}),s.setParameters({color:f}),o.setParameters({color:d})}),pe)}destroy(){this._themeHandle.remove(),super.destroy()}}function hs({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:a,outlineMaterial:r,calloutMaterial:i}){const s=e===ge.CENTER_ON_CALLOUT?z:0,o=[R(s,0,-24),R(s,0,yt/2)],c=ms(o),l=Ve({vertices:o,padding:0,materials:{tube:t,tip:n,cap:a}}),d=Ve({vertices:o,padding:Vt,materials:{tube:r,tip:r,cap:r}}),g=U(i,[[s,0,0],[s-z,0,0]]),f=U(i,[[s,0,0],[s-z,0,0]]);return{renderObjects:[...l.normal.map((p=>new b(p,_.Unfocused|I))),...d.normal.map((p=>new b(p,_.Unfocused|I))),new b(g,_.Unfocused|I|te),...l.focused.map((p=>new b(p,_.Focused|I))),...d.focused.map((p=>new b(p,_.Focused|I))),new b(f,_.Focused|I|te)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[c]},collisionPriority:1,radius:Be,state:I}}function Ve({vertices:e,padding:t,materials:n}){const a=r=>{const i=e.slice(),s=w(u.get(),i[0],i[1]);S(s,s);const o=w(u.get(),i[i.length-1],i[i.length-2]);if(S(o,o),t>0){const G=h(Q(),o,-t);i[i.length-1]=m(G,G,i[i.length-1]);const N=h(Q(),s,-t);i[0]=m(N,N,i[0])}const c=r?jt:1,l=de*c,d=Be*c,g=ve(k.get());if(t>0){const G=l/4,N=K(u.get(),0,G,0),q=1+t/G;Re(g,g,N),We(g,g,K(u.get(),q,q,q)),Re(g,g,h(N,N,-1/q))}const f=ve(ie()),p=R(0,1,0),O=Pe(ie(),Me(Se.get(),p,o));O[12]=i[i.length-1][0],O[13]=i[i.length-1][1],O[14]=i[i.length-1][2],F(O,O,g);const H=n.tube,L=ps(Wt*(r?Gt:1)+t,i,H);L.transformation=f;const $=[L],re=n.tip,W=Le(re,l,d,24,!1,!1,!0);W.transformation=O,$.push(W);const B=n.cap,ae=Le(B,l,d,24,!1,!0,!1);ae.transformation=O,$.push(ae);const x=Pe(ie(),Me(Se.get(),p,s));return x[12]=i[0][0],x[13]=i[0][1],x[14]=i[0][2],F(x,x,g),$.push(W.instantiate({transformation:x})),$.push(ae.instantiate({transformation:x})),$};return{normal:a(!1),focused:a(!0)}}function ps(e,t,n){const a=[];for(let i=0;i<12;i++){const s=i/12*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}return Rt(n,a,t,[],[],!1)}function ms(e,t){const n=w(Q(),e[e.length-1],e[e.length-2]);S(n,n),h(n,n,de),m(n,n,e[e.length-1]);{const a=w(Q(),e[0],e[1]);return S(a,a),h(a,a,de),m(a,a,e[0]),[a,...e,n]}}const bs=Object.freeze(Object.defineProperty({__proto__:null,build:Xe},Symbol.toStringTag,{value:"Module"}));export{Vs as A,I as C,_e as E,ge as H,qs as I,Gs as L,v as M,Ws as R,te as S,ne as U,js as V,ee as _,Qt as a,Ms as b,Ss as c,Kt as d,vs as e,ue as f,Us as g,us as h,ys as j,Ls as l,Hs as m,Ns as p,Ps as r,Rs as s,Jt as t,xs as u,Fs as v,Bs as w,Ds as x};
