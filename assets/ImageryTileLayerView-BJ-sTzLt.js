import{r as n,m as u,d as O,bm as P,aa as L}from"./index-BdmtnMtL.js";import{r as $,V as A,t as c,n as _}from"./rasterFieldUtils-64y26Z6E.js";import{i as C}from"./timeSupport-LzrBd8D8.js";import{C as z,m as R,O as D}from"./rasterProjectionHelper-B2AiJLNF.js";import{p as N}from"./popupUtils-B6p4SpQd.js";const J=b=>{let t=class extends b{constructor(){super(...arguments),this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){var i;return C(this.layer,(i=this.view)==null?void 0:i.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?z(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(i){try{return!this.layer.loaded||!!R(this.layer.serviceRasterInfo,i)}catch{return!1}}async fetchPopupFeaturesAtLocation(i,y){var g,v;const{layer:e}=this;if(!i)throw new P("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:T}=e,I=N(e,y);if(!T||I==null)return[];const f=[],{value:l,magdirValue:s,processedValue:p}=await e.identify(i,{timeExtent:this.timeExtent,signal:y==null?void 0:y.signal});let h="";if(l!=null&&l.length){h=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map((d=>e.getStandardTimeValue(d))).join(", "):l.join(", ");const r={ObjectId:0};r[c.servicePixelValue]=e.type==="imagery-tile"&&$(e.raster)?p==null?void 0:p.join(", "):h,r[c.rawServicePixelValue]=h;const o=((g=e.raster)==null?void 0:g.rasterInfo)??e.serviceRasterInfo,x=o==null?void 0:o.attributeTable;if(x!=null){const{fields:d,features:j}=x,w=d.find((({name:a})=>a.toLowerCase()==="value")),F=r[c.servicePixelValue],m=w?j.find((a=>String(a.attributes[w.name])===F)):null;if(m)for(const a in m.attributes)m.attributes.hasOwnProperty(a)&&(r[_+a]=m.attributes[a])}const E=o==null?void 0:o.dataType;E!=="vector-magdir"&&E!=="vector-uv"||(r[c.magnitude]=s==null?void 0:s[0],r[c.direction]=s==null?void 0:s[1]);const{multidimensionalDefinition:V}=this.layer.normalizeRasterFetchOptions({timeExtent:this.timeExtent});A(e.rasterFields,r,V);const S=new L({geometry:(v=this.fullExtent)==null?void 0:v.clone(),attributes:r,layer:e,sourceLayer:e});f.push(S)}return f}async getSourceScale(){return await this.layer.load(),D(this.layer.serviceRasterInfo,this.view.spatialReference)}_getFullExtent(){return R(this.layer.serviceRasterInfo,this.view.spatialReference)}};return n([u()],t.prototype,"fullExtent",null),n([u()],t.prototype,"layer",void 0),n([u({readOnly:!0})],t.prototype,"timeExtent",null),n([u()],t.prototype,"tileInfo",void 0),n([u({readOnly:!0})],t.prototype,"hasTilingEffects",null),n([u()],t.prototype,"datumTransformation",null),t=n([O("esri.views.layers.ImageryTileLayerView")],t),t};export{J as f};
