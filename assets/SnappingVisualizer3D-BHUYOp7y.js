import{e as fe,ab as G,r as _,m,d as xe,aU as y,dJ as ye,aO as V,aP as g,fx as j,fq as w,eJ as q,fm as F,aQ as ve,aR as B,aX as E,ap as le,aY as ce,f8 as de,aV as he,pf as be,ig as Oe,aZ as T,fb as W,aM as ue,bj as N,fy as k,pc as H,bg as Se,bh as Q,pa as M,n7 as J,p6 as X,fO as C,sX as Z,h6 as we,mS as Y,b8 as De,ba as Re,mh as K,dk as R,sY as pe,ft as _e,sZ as ee,pk as $e,ot as U,il as f,g0 as Me,s_ as Ce,nu as Pe,s$ as ze,t0 as I,eG as Ae,t1 as Te}from"./index-CxDa6KP7.js";import{G as Ge,V as je}from"./ExtendedLineVisualElement-BB24jHrD.js";import{t as me}from"./EngineVisualElement-CQwtNgcE.js";import{S as te}from"./PointVisualElement-qLIoUj7O.js";import{A as re}from"./ColorMaterial.glsl-ChUUNbMA.js";import{r as Ee}from"./SnappingContext-BV-op1kH.js";let He=i=>({vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),ge=(i,e,t)=>{for(let r=0,o=e.length;r<o;r++){let s=e[r];Array.isArray(s)?ge(i,s,t):s!=null&&s!==!1&&(typeof s=="string"&&(s=He(s)),t.push(s))}};function Ie(i,e,t){if(Array.isArray(e))t=e,e=void 0;else if(e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector"))||t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let r,o;return t&&t.length===1&&typeof t[0]=="string"?r=t[0]:t&&(o=[],ge(i,t,o),o.length===0&&(o=void 0)),{vnodeSelector:i,properties:e,children:o,text:r===""?void 0:r,domNode:null}}const ie={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let p=class extends fe{get position(){return[this.x,this.y]}set position(i){this._set("x",i[0]),this._set("y",i[1])}get _textShadowColor(){const{textColor:i,backgroundColor:e}=this,t=e.clone();return t.a*=i.a,t}get _textShadow(){const i=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${i}`}get padding(){return .5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(i){this._overrideIfSome("borderRadius",i)}constructor(i){super(i),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new G([0,0,0,.6]),this.textColor=new G([255,255,255]),this._textShadowSize=1}render(){return Ie("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(i){if(!this.visible)return;const e=i.font.replace(/^(.*?)px/,"");i.font=`${this.fontSize}px ${e}`;const{padding:t,borderRadius:r}=this,o=i.measureText(this.text).width,s=this.text!==""?this.fontSize:0,a=Ve[this.anchor];i.textAlign="center",i.textBaseline="middle";const n=o+2*t,l=s+2*t,c=this.x+a.x*n,h=this.y+a.y*l;this._roundedRect(i,c,h,n,l,r),i.fillStyle=this.backgroundColor.toCss(!0),i.fill();const u=this.x+(a.x+.5)*n,d=this.y+(a.y+.5)*l;this._renderTextShadow(i,this.text,u,d),i.fillStyle=this.textColor.toCss(!0),i.fillText(this.text,u,d)}_renderTextShadow(i,e,t,r){i.lineJoin="miter",i.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/L.length})`;const o=this._textShadowSize;for(const[s,a]of L)i.fillText(e,t+o*s,r+o*a)}_roundedRect(i,e,t,r,o,s){s=Math.min(s,o/2,r/2),i.beginPath(),i.moveTo(e,t+s),i.arcTo(e,t,e+s,t,s),i.lineTo(e+r-s,t),i.arcTo(e+r,t,e+r,t+s,s),i.lineTo(e+r,t+o-s),i.arcTo(e+r,t+o,e+r-s,t+o,s),i.lineTo(e+s,t+o),i.arcTo(e,t+o,e,t+o-s,s),i.closePath()}_cssClasses(){const i={"esri-text-overlay-item":!0};let e;for(e in ie)i[ie[e]]=this.anchor===e;return i}};_([m()],p.prototype,"x",void 0),_([m()],p.prototype,"y",void 0),_([m()],p.prototype,"position",null),_([m()],p.prototype,"text",void 0),_([m()],p.prototype,"fontSize",void 0),_([m()],p.prototype,"anchor",void 0),_([m()],p.prototype,"visible",void 0),_([m()],p.prototype,"isDecoration",void 0),_([m()],p.prototype,"backgroundColor",void 0),_([m()],p.prototype,"textColor",void 0),_([m()],p.prototype,"_textShadowSize",void 0),_([m()],p.prototype,"_textShadowColor",null),_([m()],p.prototype,"_textShadow",null),_([m()],p.prototype,"padding",null),_([m()],p.prototype,"borderRadius",null),p=_([xe("esri.views.overlay.TextOverlayItem")],p);const Ve={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},L=[];for(let e=0;e<360;e+=360/16)L.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);let qe=class extends me{constructor(e){super(e),this._location=y(),this._direction=ye(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=V(1,0,1,1),this._renderOccluded=g.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:Fe,recreateGeometry:(t,r)=>this._recreateObject3DGeometry(t,r),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(t,r)=>r(t.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Be,recreateGeometry:t=>this._recreateDrapedGeometry(t),forEachMaterial:(t,r)=>r(t.material)}}get location(){return this._location}set location(e){j(this._location,e)||(w(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){j(this._direction,e)||(w(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){q(this._direction,F(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){ve(e,this._color)||(B(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}_createObject3DResources(e){const t=new E(this.materialParameters),r=new Array;return this._createObject3DGeometry(t,e,r),{material:t,geometries:r}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,r){const[o,s]=oe(e);t.addGeometry(o),t.addGeometry(s),r.push(o),r.push(s),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new E(this.materialParameters),t=le((()=>this.view.state.contentPixelRatio),(()=>this.drapedResources.recreateGeometry()));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=oe(e);return this._updateVerticesDraped(t),t.map((r=>new ce(r)))}_updateMaterial(){var t,r;const{materialParameters:e}=this;(t=this.object3dResources.resources)==null||t.material.setParameters(e),(r=this.drapedResources.resources)==null||r.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,z),he(x,this.location,this.direction),t.projectToScreen(x,S),be(S,Oe(S,S,z)),this._updateVertexAttributesObject3D(t,e,0,z,S,1),this._updateVertexAttributesObject3D(t,e,1,z,S,-1)}_updateVertexAttributesObject3D(e,t,r,o,s,a){var u;const n=t.geometries[r],l=(u=n.getMutableAttribute(T.POSITION))==null?void 0:u.data;if(!l)return;const{start:c,end:h}=se(s,o,a,this.offset,this.width,this.length);e.unprojectFromScreen(W(c),x),l[0]=x[0],l[1]=x[1],l[2]=x[2],e.unprojectFromScreen(W(h),x),l[3]=x[0],l[4]=x[1],l[5]=x[2],t.geometryVertexAttributeUpdated(n,T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{location:o,width:s,length:a,offset:n}=this,l=Ne;l.spatialReference=t.renderer.spatialReference,l.x=o[0],l.y=o[1];const c=this.view.overlayPixelSizeInMapUnits(l)*r,h=s*c,u=a*c,d=n*c;this._updateVertexAttributesDraped(e[0],h,u,d,-1),this._updateVertexAttributesDraped(e[1],h,u,d,1)}_updateVertexAttributesDraped(e,t,r,o,s){var u;const a=(u=e.getMutableAttribute(T.POSITION))==null?void 0:u.data;if(!a)return;const{location:n,direction:l}=this,{start:c,end:h}=se(l,n,s,o,t,r);a[0]=c[0],a[1]=c[1],a[2]=N,a[3]=h[0],a[4]=h[1],a[5]=N,e.invalidateBoundingInfo()}};function oe(i){return[k(i,[y(),y()]),k(i,[y(),y()])]}function se(i,e,t,r,o,s){const a=H(ae,Se(ae,i[1]*t,i[0]*-t),r+o/2),n=M(P,M(P,M(P,e,H(P,i,s/2)),a),a);return{start:n,end:M(ne,n,H(ne,i,-s))}}function Fe(i){i.geometries.length=0}function Be(i){i.pixelRatioHandle.remove(),i.geometries=[]}const x=y(),ae=Q(),P=Q(),ne=Q(),z=de(),S=de(),Ne=ue(0,0,void 0,null);class ke extends me{constructor(e){super(e),this._maxSize=0,this._position=y(),this._up=y(),this._right=y(),this._renderOccluded=g.OccludeAndTransparent,this._color=V(1,0,0,1),this._outlineColor=V(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=g.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:t=>this._createObject3DResources(t),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D(),forEachMaterial:(t,r)=>{r(t.outlineMaterial),r(t.quadMaterial)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Ue,forEachMaterial:(t,r)=>{r(t.outlineMaterial),r(t.quadMaterial)}}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateOutlineMaterial(),this._updateQuadMaterial()}get color(){return this._color}set color(e){B(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){B(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:r}){this._maxSize=Math.min(J(t,e),J(t,r))/3,q(this._up,F(this._up,e,t)),q(this._right,F(this._right,r,t)),w(this._position,t),this.recreateGeometry()}_createObject3DResources(e){const t=new re(this._quadMaterialParameters),r=this._outlineSize===0?void 0:new E(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,r),{quadMaterial:t,outlineMaterial:r}}_createObject3DGeometries(e,t,r){if(j(this._up,X)&&j(this._right,X))return;const o=this._createGeometries(t,r);for(const s of o)e.addGeometry(s);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new re(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new E(this._outlineMaterialParameters),r=this._createGeometries(e,t).map((o=>new ce(o)));return this._setTransformDraped(r),{quadMaterial:e,outlineMaterial:t,geometries:r,pixelRatioHandle:le((()=>this.view.state.contentPixelRatio),(()=>this.drapedResources.recreateGeometry()))}}_createGeometries(e,t){const{up:r,right:o,corner:s}=this._getVertices(),a=Le(r,o,s,e);return t?[a,k(t,[r,s,o])]:[a]}_getVertices(){let e=this._up,t=this._right;const r=he(C.get(),e,t);return this.isDraped&&(e=w(C.get(),e),t=w(C.get(),t),e[2]=0,t[2]=0,r[2]=0),{up:e,right:t,corner:r}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;const t=this.view.state.camera,r=this._size*t.computeScreenPixelSizeAt(this._position),o=Math.min(this._maxSize,r);Z(v,this._position),Y(v,v,[o,o,o]),e.transformation=v}_setTransformDraped(e){if(e.length===0)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:r}}}=this,{_position:o,_size:s}=this,a=w(C.get(),o);a[2]=N;const n=Qe;n.spatialReference=t.renderer.spatialReference,n.x=a[0],n.y=a[1];const l=s*(this.view.overlayPixelSizeInMapUnits(n)*r),c=Math.min(this._maxSize,l);Z(v,a),Y(v,v,[c,c,1]);for(const h of e)h.transformation=v}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;(e=this.object3dResources.resources)==null||e.quadMaterial.setParameters(this._quadMaterialParameters),(t=this.drapedResources.resources)==null||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t,r,o;(t=(e=this.object3dResources.resources)==null?void 0:e.outlineMaterial)==null||t.setParameters(this._outlineMaterialParameters),(o=(r=this.drapedResources.resources)==null?void 0:r.outlineMaterial)==null||o.setParameters(this._outlineMaterialParameters)}}function Ue(i){i.pixelRatioHandle.remove(),i.geometries=[]}function Le(i,e,t,r){return new De(r,[[T.POSITION,new Re([0,0,0,...e,...i,...t],[0,1,2,1,2,3],3,!0)]])}const v=we(),Qe=ue(0,0,void 0,null);class rt extends Ee{sortUniqueHints(e){return e.sort(((t,r)=>(r instanceof K?r.length:0)-(t instanceof K?t.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:r,view:o}=t,s=$(t);return R(new te({view:o,primitive:"circle",geometry:ee(e.intersectionPoint,r),elevationInfo:e.isDraped?pe:_e,size:20,outlineSize:2,color:s.intersectionPointColor,outlineColor:s.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:r,spatialReference:o}=t,s=$(t),a=b(e.point,e.domain,t);return R(new te({view:r,primitive:"circle",geometry:ee(a,o),elevationInfo:A(e),size:20,outlineSize:2,color:s.pointColor,outlineColor:s.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:r,spatialReference:o}=t,s=$(t),a=b(e.lineStart,e.domain,t),n=b(e.lineEnd,e.domain,t);return R(We(e.type,a,n,o,A(e),r,s,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:r,spatialReference:o}=t,s=$(t),{isDraped:a}=e,n=A(e),l=b(e.lineStart,e.domain,t),c=b(e.lineEnd,e.domain,t),h=O(l,o,n,r,a),u=O(c,o,n,r,a),d=$e(u,h,u,.5),D=new qe({view:r,attached:!1,offset:f.parallelLineHintOffset,length:f.parallelLineHintLength,width:f.parallelLineHintWidth,color:s.parallelSignColor,location:d,renderOccluded:a?g.OccludeAndTransparent:g.Opaque,isDraped:a,renderGroup:U.SnappingHint,isDecoration:!0});return D.setDirectionFromPoints(h,d),D.attached=!0,R(D)}visualizeRightAngleQuad(e,t){const{view:r,spatialReference:o}=t,s=$(t),a=A(e),{isDraped:n}=e,l=b(e.previousVertex,e.domain,t),c=b(e.centerVertex,e.domain,t),h=b(e.nextVertex,e.domain,t),u=O(l,o,a,r,n),d=O(c,o,a,r,n),D=O(h,o,a,r,n);return R(new ke({view:r,attached:!0,color:n?s.rightAngleColorDraped:s.rightAngleColor,renderOccluded:n?g.OccludeAndTransparent:g.Transparent,outlineRenderOccluded:n?g.OccludeAndTransparent:g.Opaque,outlineColor:s.rightAngleOutlineColor,outlineSize:f.rightAngleHintOutlineSize,size:f.rightAngleHintSize,isDraped:n,geometry:{previous:u,center:d,next:D},renderGroup:U.SnappingHint,isDecoration:!0}))}}function $(i){const{effectiveTheme:e}=i.view,t=G.toUnitRGBA(e.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:t,pointColor:r,pointOutlineColor:t,lineColor:t,lineOutlineColor:void 0,parallelSignColor:t,rightAngleColor:t,rightAngleColorDraped:G.toUnitRGBA(Me(e.accentColor,.5)),rightAngleOutlineColor:t}}function b(i,e,{selfSnappingZ:t,view:r,spatialReference:o}){return(e&Pe.SELF)!==0&&ze(i)&&t!=null?Ce(i,t,r,o):i}function A(i){return i.isDraped?pe:_e}function We(i,e,t,r,o,s,a,n=!1,l=!0,c=!0){const h=O(e,r,o,s,n),u=O(t,r,o,s,n),d=new Ge({view:s,extensionType:je.FADED,start:h,end:u,isDraped:n,color:a.lineColor,renderOccluded:n?g.OccludeAndTransparent:g.Opaque,renderGroup:U.SnappingHint,isDecoration:!0});switch(i){case I.TARGET:d.width=f.lineHintWidthTarget,d.fadedExtensions={start:0,end:f.lineHintFadedExtensions};break;case I.REFERENCE_EXTENSION:d.width=f.lineHintWidthReference,d.fadedExtensions={start:0,end:0};break;case I.REFERENCE:d.width=f.lineHintWidthReference,d.fadedExtensions={start:l?f.lineHintFadedExtensions:0,end:c?f.lineHintFadedExtensions:0}}return d.attached=!0,d}function O(i,e,t,r,o){const s=y();if(o){const a=r.basemapTerrain.overlayManager.renderer.spatialReference;Ae(i,e,s,a)}else Te(i,e,t,r,s);return s}export{rt as R,p as n,Ie as t,ke as y};
