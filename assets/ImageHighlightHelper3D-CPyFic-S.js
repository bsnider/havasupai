const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GraphicsView3D-Izc56Lkp.js","assets/index-Ds3x37R4.js","assets/index-Bq0sc0Rv.css","assets/GraphicsProcessor-p1PrSsFP.js","assets/renderingInfoUtils-BM-uPzZg.js","assets/ExtentSet-DkI5OnVJ.js","assets/optimizedFeatureQueryEngineAdapter-tr85M_LY.js","assets/PooledRBush-BohpeaqJ.js","assets/popupUtils-B7wJAZVr.js","assets/Graphics3DObjectStates-Dwz9cS8k.js","assets/highlightUtils-CYNMXq-E.js"])))=>i.map(i=>d[i]);
import{e as c,d8 as d,a0 as u,d9 as w,da as _,Z as y,Y as g,_ as m,X as f,ae as v,ai as V,db as H,dc as $,dd as G,r as o,m as p,d as C}from"./index-Ds3x37R4.js";import{i as L}from"./highlightUtils-OenP77c5.js";let h=class extends c{get updating(){var s;return((s=this.graphicsView)==null?void 0:s.updating)??!1}constructor(s){super(s),this._highlightCounts=new Map,this._graphicsViewLoader=null,this.graphics=new d,this.graphicsView=null,this.suspended=!1;const e=new u([255,255,255,1/255]);this._symbols=new Map([["point",new w({size:"2px",style:"square",color:e})],["polyline",new _({width:"2px",color:e})],["polygon",new y({outline:null,color:e})]])}highlight(s,e){const t=L(s);if(t.length===0)return g();let a,i=!1;return this.updatingHandles.addPromise(Promise.all([this._createHighlightGraphics(t),this._ensureGraphicsView3D()]).then((([n,r])=>{!i&&r&&(a=this._addHighlightGraphics(r,n,e))}))),g((()=>{i=!0,a==null||a.remove()}))}preload(){this._ensureGraphicsView3D()}_addHighlightGraphics(s,e,t){for(const i of e)this._highlightCounts.set(i,(this._highlightCounts.get(i)??0)+1);this.graphics.addMany(e);const a=s.highlight(e,t);return g((()=>{this._removeHighlightGraphics(e),a.remove()}))}_removeHighlightGraphics(s){this.graphics.removeMany(s.filter((e=>{const t=Math.max(0,(this._highlightCounts.get(e)??0)-1);return t===0?(this._highlightCounts.delete(e),!0):(this._highlightCounts.set(e,t),!1)})))}async _ensureGraphicsView3D(){if(this.graphicsView)return this.graphicsView;this._graphicsViewLoader||(this._graphicsViewLoader=m(()=>import("./GraphicsView3D-Izc56Lkp.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])));const{default:s}=await this._graphicsViewLoader;if(this.destroyed)return null;const e=new s({view:this.view,layer:this.layer,getGraphics:()=>this.graphics,drapeSourcePriorityOffset:.5});return this._set("graphicsView",e),this.addHandles([f(this.graphicsView),v((()=>this.suspended),(t=>{e.suspended=t}),V)]),e}async _createHighlightGraphics(s){const e=s.map((({geometry:i})=>i==null?void 0:i.spatialReference)).filter(H).reduce(((i,n)=>{var r;return i.length!==0&&((r=i.at(-1))!=null&&r.equals(n))||i.push(n),i}),[]),t=this.view.spatialReference,a=e.map((i=>({source:i,dest:t})));try{await $(a)}catch{return[]}return s.map((i=>{const{geometry:n}=i;try{const r=n?G(n,t):null,l=i.cloneShallow();return l.geometry=r,l.symbol=this._symbols.get(r==null?void 0:r.type),l}catch{return i}}))}};o([p()],h.prototype,"graphics",void 0),o([p()],h.prototype,"graphicsView",void 0),o([p()],h.prototype,"view",void 0),o([p()],h.prototype,"layer",void 0),o([p()],h.prototype,"updatingHandles",void 0),o([p()],h.prototype,"suspended",void 0),o([p()],h.prototype,"updating",null),h=o([C("esri.views.3d.layers.support.ImageHighlightHelper3D")],h);export{h as w};
