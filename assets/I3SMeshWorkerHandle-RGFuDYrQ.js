import{aE as M,dj as x,bW as O,aU as j,ic as N,eG as R}from"./index-BdmtnMtL.js";var I,u;(function(t){t[t.None=0]="None",t[t.Int16=1]="Int16",t[t.Int32=2]="Int32"})(I||(I={})),(function(t){t[t.Replace=0]="Replace",t[t.Outside=1]="Outside",t[t.Inside=2]="Inside",t[t.Finished=3]="Finished"})(u||(u={}));class v{constructor(o,e,i,h,a,p){this.layout=o,this.interleavedVertexData=e,this.indices=i,this.hasColors=h,this.hasModifications=a,this.positionData=p}}class L{constructor(o,e,i,h,a,p,d){this.componentOffsets=o,this.featureIds=e,this.anchorIds=i,this.anchors=h,this.transformedGeometry=a,this.globalTrafo=p,this.obb=d}}class w extends N{constructor(o){super("SceneLayerWorker","process",{process:e=>[e.geometryBuffer],project:e=>[e.positions.buffer],transformNormals:e=>[e.normals.buffer]},o,{hasInitialize:!0})}setModifications(o,e,i,h){const a={context:o,modifications:S(e,i,h),isGeodetic:h.isGeographic};this.broadcast(a,"setModifications")}setLegacySchema(o,e){const i=JSON.stringify(e);return this.broadcast({context:o,jsonSchema:i},"setLegacySchema")}destroyContext(o){return this.broadcast(o,"destroyContext")}project(o,e){return this.invokeMethod("project",o,e)}transformNormals(o,e){return this.invokeMethod("transformNormals",o,e)}}const s=new M({deallocator:null}),f=j();function S(t,o,e){s.clear();let i=1/0,h=1/0,a=-1/0,p=-1/0,d=!1;for(const r of o){const y=r.type==="clip"?u.Inside:r.type==="mask"?u.Outside:u.Replace,l=r.geometry;let m=n=>n;if(l.spatialReference){if(!x(l.spatialReference,e)){O.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}m=n=>(R(n,l.spatialReference,f,e),f)}else l.hasZ||(f[2]=0,m=n=>(f[0]=n[0],f[1]=n[1],f));d=d||y===u.Outside,s.push(y),s.push(l.rings.length);for(const n of l.rings){s.push(n.length);for(const b of n){const c=m(b);s.push(c[0]),s.push(c[1]),s.push(c[2]),i=Math.min(i,c[0]),h=Math.min(h,c[1]),a=Math.max(a,c[0]),p=Math.max(p,c[1])}}}t!=null&&(d?(s.push(u.Inside),s.push(2),s.push(4),s.push(i-1e-4),s.push(h-1e-4),s.push(0),s.push(a+1e-4),s.push(h-1e-4),s.push(0),s.push(a+1e-4),s.push(p+1e-4),s.push(0),s.push(i-1e-4),s.push(p+1e-4),s.push(0),s.push(4),s.push(t[0]),s.push(t[1]),s.push(0),s.push(t[2]),s.push(t[1]),s.push(0),s.push(t[2]),s.push(t[3]),s.push(0),s.push(t[0]),s.push(t[3]),s.push(0)):(s.push(u.Outside),s.push(1),s.push(4),s.push(t[0]),s.push(t[1]),s.push(0),s.push(t[2]),s.push(t[1]),s.push(0),s.push(t[2]),s.push(t[3]),s.push(0),s.push(t[0]),s.push(t[3]),s.push(0))),s.push(u.Finished);const g=new Float64Array(s.length);for(let r=0;r<s.length;++r)g[r]=s.at(r);return g}export{v as a,w as b,S as f,I as n,L as p};
